<!DOCTYPE HTML>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Registration and Visualisation, Chaoqun Yin">
    <meta name="description" content="Veni, Vidi, Vici">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Registration and Visualisation | Chaoqun Yin</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.3.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Chaoqun Yin</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Index</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>Contact</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>Friends</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Chaoqun Yin</div>
        <div class="logo-desc">
            
            Veni, Vidi, Vici
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			About
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			Friends
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/21.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Registration and Visualisation</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Biomedical-Signals-and-Images/">
                                <span class="chip bg-color">Biomedical Signals and Images</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Digital-Health/" class="post-category">
                                Digital Health
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2021-04-20
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>Update Date:&nbsp;&nbsp;
                    2021-08-10
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp;
                    3.7k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>Read Times:&nbsp;&nbsp;
                    23 Min
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="registration-and-visualisation">Registration and Visualisation</h1>
<p><a href="https://yintelligence.tech/2021/01/06/2021-01-06-VUB-4019776DNR-Biomedical-Signals-and-Images/">VUB 4019776DNR Biomedical Signals and Images</a></p>
<p><a target="_blank" rel="noopener" href="https://canvas.vub.be/courses/18933/files/634835?module_item_id=117308">Slide</a> + <a target="_blank" rel="noopener" href="https://vub.cloud.panopto.eu/Panopto/Pages/Viewer.aspx?id=a0de334e-9dd5-41fe-b444-ac7100d5cfd0">Video</a></p>
<h2 id="medical-image-registration">Medical Image Registration</h2>
<h3 id="introduction">Introduction</h3>
<p>Two images of the same patient</p>
<ul>
<li>How to accurately compare the images?</li>
<li>Ensure we are looking at the same tissue?</li>
</ul>
<p>Use <strong>registration</strong> to bring the objects in the same reference system</p>
<h4 id="why-registration">Why registration?</h4>
<ul>
<li>Comparing different images of the same patient
<ul>
<li>Images acquired at a <strong>different time</strong>, or using a <strong>different modality</strong></li>
</ul></li>
<li>Compare different images
<ul>
<li>Follow-up: compare images of the <strong>same patient over time</strong></li>
<li>Inspect the progress of his state or disease</li>
</ul></li>
<li>Estimating motion
<ul>
<li>Motion across a <strong>dynamic</strong> （2D+T or 3D+T） sequence</li>
<li>Motion or deformations between two <strong>static acquisitions</strong></li>
</ul></li>
<li>Image-guided interventions
<ul>
<li>Image-guided <strong>radiotherapy</strong>
<ul>
<li>Registration of planning CT with in-room imaging</li>
</ul></li>
<li>Image-guided <strong>surgery</strong>
<ul>
<li>Alignment of pre- and per-surgery imaging for establishing position of tracked instruments</li>
</ul></li>
</ul></li>
</ul>
<h3 id="the-registration-process">The registration process</h3>
<h4 id="registration-in-physical-space">Registration in physical space</h4>
<h5 id="images-as-a-measurement-in-physical-space">Images as a measurement in physical space</h5>
<p>Medical images are usually “calibrated”</p>
<ul>
<li>Dimensions of a pixel known with great certainty</li>
<li>Position of image known with respect to room</li>
</ul>
<p>Images are used for treatment planning and guidance</p>
<ul>
<li>Image guided radiotherapy</li>
<li>Interventional radiology</li>
<li>Image-guided surgery</li>
</ul>
<h5 id="coordinate-systems">Coordinate systems</h5>
<p>A digital Image is a sampling of a continuous field using a discrete grid</p>
<h6 id="the-image-or-pixel-coordinate-system">The image or <u>pixel coordinate</u> system</h6>
<ul>
<li>Simply <strong>count the pixels</strong> along each dimension （indices）</li>
<li>Convention about the order of dimensions</li>
<li>Pixels fall on <strong>integer positions</strong> of the coordinate system</li>
<li>[0,0] falls on an edge of the image</li>
<li><strong>The unit is in pixels</strong></li>
</ul>
<p><img src="/images/HMS/1937300.png" /></p>
<h6 id="the-physical-coordinate-system">The <u>physical coordinate</u> system</h6>
<ul>
<li>The coordinate <code>(x,y)</code> of all points according to an
<ul>
<li>Origin</li>
<li>Coordinate axes (usually aligned with the image）</li>
<li>Spatial dimensions along each axis</li>
</ul></li>
<li><strong>The unit is in millimetre</strong></li>
</ul>
<p><img src="/images/HMS/1937301.png" /></p>
<h5 id="spatial-information">Spatial information</h5>
<ul>
<li>Stored in the medical image header</li>
<li>Referencing the image wrt the room or imaging device
<ul>
<li><strong>Origin （of an image &lt;-&gt; of a coordinate system）</strong>
<ul>
<li>The physical coordinate of the first pixel</li>
<li>Not necessarily （0,0）</li>
</ul></li>
<li><strong>Spacing</strong>
<ul>
<li>The physical space between pixels in each dimension</li>
</ul></li>
</ul></li>
</ul>
<p><img src="/images/HMS/1937302.png" /></p>
<h4 id="goal">Goal</h4>
<p>The goal of registration is to find the <strong>spatial transformation</strong> T, which aligns anatomical structures in the considered images</p>
<ul>
<li>Maps points p onto homologous/corresponding points q</li>
</ul>
<p><img src="/images/HMS/1937303.png" /></p>
<p><strong>Registration takes place in the physical space</strong></p>
<p><img src="/images/HMS/1937304.png" /></p>
<h5 id="why-physical-space">Why physical space?</h5>
<p>Performing operations in pixel space</p>
<ul>
<li>Will not respect the <strong>spacing along each dimension of images</strong>
<ul>
<li>Which could be different from one image to another</li>
</ul></li>
<li>Will not work if <strong>images change size</strong>
<ul>
<li>A cropped image in pixel space results in different indices for pixels</li>
<li>A cropped image in physical space retains the same coordinates for pixels</li>
</ul></li>
<li>Will not lead to a transformation <strong>valid for the physical space</strong>
<ul>
<li>Were are sometimes not interested in aligning the images</li>
<li>We may want to know <strong>how to align the patient in the treatment room</strong>!</li>
</ul></li>
</ul>
<h4 id="mathematical-formulation">Mathematical formulation</h4>
<p>Find the <strong>transform</strong> which <strong>optimizes</strong> the alignment of the <strong>fixed</strong> and transformed <strong>moving</strong> image, with respect to a given <strong>cost function</strong> or <strong>metric</strong> <span class="math display">\[
\hat\mu = \arg\min_{\mu}C_{x ∈\Omega}(f(x),g(T_{\mu}(x)))
\]</span></p>
<ul>
<li>Spatial coordinate x
<ul>
<li>Overlap region Ω</li>
</ul></li>
<li>Transform parameters μ</li>
<li>Input images
<ul>
<li>Fixed or reference images f （x）</li>
<li>Moving or target image g （x）</li>
</ul></li>
<li>Transformation T
<ul>
<li>Rigid transformation</li>
<li>Affine transformation</li>
<li>Deformable transformation</li>
<li>…</li>
</ul></li>
<li>Metric C
<ul>
<li>feature-based metric</li>
<li>Intensity-based metric</li>
<li>Regularizer or penalties</li>
</ul></li>
</ul>
<h4 id="overview-of-components-of-registration">Overview of components of registration</h4>
<p><img src="/images/HMS/1937305.png" /></p>
<ul>
<li>Input images
<ul>
<li>Fixed or reference images f （x）</li>
<li>Moving or target image g （x）</li>
</ul></li>
<li>Metric
<ul>
<li>feature-based metric</li>
<li>Intensity-based metric</li>
<li>Regularizer or penalties – …</li>
</ul></li>
<li>Optimizer
<ul>
<li>With or without gradient</li>
</ul></li>
<li>Transform T
<ul>
<li>Rigid transform</li>
<li>Affine transform</li>
<li>Deformable transform</li>
<li>…</li>
</ul></li>
<li>Interpolator
<ul>
<li>Nearest neighbour</li>
<li>Linear interpolation</li>
<li>B-spline interpolation</li>
<li>…</li>
</ul></li>
</ul>
<h3 id="interpolators">Interpolators</h3>
<p>When transforming an image, the pixels of the transformed image do no longer overlap with pixels / grid positions of the reference image x</p>
<p><strong>So how do we compute?</strong></p>
<p><img src="/images/HMS/1937306.png" /></p>
<ul>
<li>How do we obtain image values between the sample points?</li>
<li>How do we recover a function that is at least C<sub>0</sub> continuous?</li>
</ul>
<p><img src="/images/HMS/1937307.png" /></p>
<p>Based on the （image) samples, reconstruct a continuous function</p>
<ul>
<li>Typically making assumptions / modelling the signal
<ul>
<li>Continuous （C<sub>0</sub>）</li>
<li>Continuous and smooth （C<sub>1</sub>）</li>
<li>Derivative <strong>continuous</strong> and smooth （C<sub>2</sub>）</li>
<li>…</li>
</ul></li>
<li>Balance between quality and computational cost</li>
</ul>
<p><img src="/images/HMS/1937308.png" /></p>
<h4 id="d-and-2d-view">1D and 2D view</h4>
<p><img src="/images/HMS/1937309.png" /></p>
<ul>
<li>In black
<ul>
<li>The position where I want to know the intensity</li>
</ul></li>
<li>In colour
<ul>
<li>The existing pixels of the image</li>
</ul></li>
<li>Increasing complexity
<ul>
<li>Nearest neighbour</li>
<li>Linear</li>
<li>（cubic） B-spline</li>
</ul></li>
</ul>
<h4 id="in-practice">In practice</h4>
<ul>
<li>Find a compromise between
<ul>
<li>Accuracy</li>
<li>Complexity （computation time）</li>
</ul></li>
<li>Methods can be combined
<ul>
<li>Initially use fast nearest neighbour</li>
<li>Refine using linear interpolator</li>
<li>In the end, resample the image using high-quality B-spline interpolation</li>
</ul></li>
</ul>
<h3 id="transformations">Transformations</h3>
<p>The most common types of transformations:</p>
<ul>
<li>Rigid</li>
<li>Affine</li>
<li>Elastic or deformable</li>
</ul>
<figure>
<img src="/images/HMS/1937310.png" alt="" /><figcaption>Parametrization in 2D</figcaption>
</figure>
<h4 id="rigid-transformation">Rigid transformation</h4>
<ul>
<li>Transformation of rigid bodies
<ul>
<li><strong>Translation</strong> along all dimensions</li>
<li><strong>Rotation</strong> w.r.t. all axes</li>
</ul></li>
<li>In three dimensions
<ul>
<li>6 degrees of freedom
<ul>
<li>3 translations</li>
<li>3 rotations</li>
</ul></li>
</ul></li>
<li>Because medical images are ”calibrated”
<ul>
<li>Voxel dimensions are known</li>
<li>Often <strong>no scaling needed</strong></li>
</ul></li>
</ul>
<p><img src="/images/HMS/1937311.png" /> <span class="math display">\[
T (x) = M.x = R.x + t
\]</span></p>
<ul>
<li><p><strong>In 3D</strong> M is the 4 × 4 <strong>homogeneous</strong> matrix</p></li>
<li><p>R is a 4 × 4 matrix, including a 3 × 3 rotation matrix</p></li>
<li><p>t is a 4 × 1 vector, including 3 × 1 translation vector</p></li>
<li><p>x is a 4 × 1 vector, including the 3 × 1 coordinates</p>
<ul>
<li><span class="math display">\[
x = (x_1,x_2,x_3,x_4)
\]</span></li>
</ul></li>
</ul>
<h4 id="affine-transformation">Affine transformation</h4>
<ul>
<li>Non-rigid transformation
<ul>
<li><strong>Not possible for rigid bodies</strong> unless non- elastically deformed</li>
</ul></li>
<li>Rigid transformation expanded with
<ul>
<li>Differential <strong>scaling</strong></li>
<li>Skew or <strong>shear</strong></li>
</ul></li>
<li>In three dimensions
<ul>
<li>12 degrees of freedom
<ul>
<li>3 translations</li>
<li>9 for rotation, shear and scaling</li>
</ul></li>
</ul></li>
</ul>
<p><img src="/images/HMS/1937312.png" /> <span class="math display">\[
T (x) = M.x
\]</span></p>
<ul>
<li><strong>In 3D</strong> M is the 4 × 4 augmented matrix x is a 4 × 1 coordinate vector</li>
</ul>
<h5 id="non-rigid-transformation">Non-rigid transformation</h5>
<ul>
<li>Some tissue types can deform
<ul>
<li>Soft tissue, cavities filled with liquid</li>
<li>Not possible for rigid bodies unless non-elastically deformed （e.g. broken bones）</li>
<li>Estimate <strong>elastic deformation</strong> of tissues</li>
</ul></li>
<li>A global transformation can not model this
<ul>
<li>Global: transformation （equation） is same for the whole image</li>
<li>Local: T<sub>μ</sub>（x）, the transform becomes dependent on the spatial coordinate x</li>
</ul></li>
</ul>
<h4 id="deformable-transformation">Deformable transformation</h4>
<ul>
<li><p>Non-parametric approaches</p>
<ul>
<li>Optimize a vector per voxel （or a subset）</li>
<li>Regularizers to ensure the deformation remains plausible</li>
</ul>
<p><img src="/images/HMS/1937313.png" /></p>
<blockquote>
<p>Deformation vector fields</p>
<ul>
<li>Each component of a vector is a parameter</li>
</ul>
</blockquote></li>
<li><p>Parametric approaches</p>
<ul>
<li>Use a parametric representation</li>
<li>Limit the amount of parameters
<ul>
<li>Thin plate splines</li>
<li>B-splines</li>
</ul></li>
</ul>
<p><img src="/images/HMS/1937314.png" /></p>
<blockquote>
<p>B-spline control point grid</p>
<ul>
<li>Control points are placed ever 5-10-20 voxels</li>
</ul>
</blockquote></li>
</ul>
<h5 id="using-b-spline-free-form-transform">Using B-spline free-form transform</h5>
<ul>
<li><p>Transformation expressed as deformation with respect to current location <span class="math display">\[
T_{\mu}(x)=x+D_{\mu}(x)
\]</span></p></li>
<li><p>Number of degrees of freedom</p>
<ul>
<li>Depends on the how fine of deformations are considered</li>
<li>10<sup>3</sup> – 10<sup>6</sup> DOF are not uncommon</li>
</ul></li>
</ul>
<p><img src="/images/HMS/1937315.png" /> <span class="math display">\[
T_{\mu}(x)=x+\sum_{i}\sum_{j}\sum_{k}p_{ijk}\beta_{i}^{x}\beta_{j}^{y}\beta_{z}^{k}\\
\beta_{i}^{x}=\beta(\frac{x-k_i}{\sigma_{x}})
\]</span></p>
<ul>
<li>In 3D, D<sub>μ</sub> is the tensorproduct of three β kernels</li>
<li><strong>p</strong> are the B-spline coefficients</li>
<li>β are B-spline kernels</li>
<li>k<sub>i</sub>, β<sub>j</sub>, β<sub>p</sub> are the locations of the control points</li>
</ul>
<h4 id="transformation">Transformation</h4>
<p>Choice depends on</p>
<ul>
<li><strong>Type of structure</strong> we are aligning
<ul>
<li>Rigid bones or deformable tissue
<ul>
<li>E.g within the skull, little to no deformation occurs. Registration of two brain images of the same patient can be done rigidly</li>
</ul></li>
</ul></li>
<li><strong>Type of motion</strong> we are expecting
<ul>
<li>Intra and interpatient registration</li>
<li>Breathing motion, patient motion, tumour motion, etc</li>
</ul></li>
<li>The <strong>image formation</strong>
<ul>
<li>Projective or not geometrically accurate （distortion）</li>
</ul></li>
</ul>
<h4 id="hierarchical-approach">Hierarchical approach</h4>
<ul>
<li>Increasing amount of parameters
<ul>
<li>Only translations</li>
<li>Rigid: translations and rotations</li>
<li>Affine: rigid, scaling and shear</li>
<li>Coarse B-spline: low amount of B-spline control points</li>
<li>Fine B-spline: high amount of control points</li>
</ul></li>
<li>More parameters → more complexity in transformation
<ul>
<li>But also: more degrees of freedom → <strong>more difficult to optimize</strong></li>
</ul></li>
<li>Complex transformations are usually optimized using an hierarchical approach
<ul>
<li><strong>Use simple transformations first</strong></li>
<li><strong>Initialize</strong> the next step using the result of the previous step</li>
</ul></li>
</ul>
<h3 id="similarity-metrics">Similarity Metrics</h3>
<h4 id="types">Types</h4>
<p>The <strong>metric or cost function</strong> is evaluating how good the current transformation is, and （based on its gradient） in which direction the transformation can improve</p>
<ul>
<li>Feature-based
<ul>
<li><strong>Manually</strong> identified points or landmarks</li>
<li><strong>Automatically</strong> extracted landmarks / feature points</li>
</ul></li>
<li>Intensity–based
<ul>
<li>Directly based on the <strong>intensity distributions</strong> of the images</li>
<li>Different types exist, relying on different <strong>assumptions for the images</strong></li>
</ul></li>
</ul>
<h5 id="landmark-based-registration">Landmark-based registration</h5>
<h6 id="principal">Principal</h6>
<p>Identify <strong>corresponding points</strong> in the images and infer the image transformation by minimizing the （<strong>mean squared</strong>） <u>distance over the set of points</u></p>
<h6 id="types-of-landmarks">Types of landmarks</h6>
<ul>
<li>Extrinsic
<ul>
<li>Artificial objects attached to the patient</li>
</ul></li>
<li>Intrinsic
<ul>
<li>Internal anatomical structures</li>
</ul></li>
</ul>
<h6 id="practical-considerations">Practical considerations</h6>
<ul>
<li>Manual identification is <strong>time-consuming</strong> and <strong>error prone</strong></li>
<li>Non-rigid registration requires large set of points</li>
<li>Extrinsic landmarks often used for <strong>neuro-surgery</strong> （rigid）, because of accuracy and robustness</li>
</ul>
<p><img src="/images/HMS/1937316.png" /></p>
<h5 id="feature-based-registration">Feature-based registration</h5>
<h6 id="principal-1">Principal</h6>
<p>Automatically identify <strong>feature point pairs</strong> and infer the image transformation by minimizing the （mean squared） distance over the set of features</p>
<h6 id="types-of-features">Types of features</h6>
<ul>
<li>Recognizable points in 3D</li>
<li>Edges, lines, shapes</li>
<li>Surfaces in the images</li>
</ul>
<p>Practical considerations</p>
<ul>
<li>Non-rigid registration requires large set of points</li>
<li>Extraction of the features is highly <u>dependent on the image content and contrast</u></li>
</ul>
<p><img src="/images/HMS/1937317.png" /></p>
<h5 id="intensity-based-registration">Intensity-based registration</h5>
<h6 id="principal-2">Principal</h6>
<ul>
<li>Assume a <strong>relation</strong> or <strong>dependency</strong> between the intensity distribution of the input images, alignment is optimized by finding the transformation the maximizes the relationship</li>
</ul>
<h6 id="types-of-relationships">Types of relationships</h6>
<ul>
<li>One-to-one relation</li>
<li>Linear correlation</li>
<li>Statistical dependency</li>
<li>….</li>
</ul>
<h6 id="practical-considerations-1">Practical considerations</h6>
<ul>
<li>No need for <strong>pre-processing</strong>, fully automated</li>
<li>The used metric （relation） is dependent on the nature of the images, the modality</li>
</ul>
<p><img src="/images/HMS/1937318.png" /></p>
<p>Joint histogram: 2D or 3D plot of the intensity pairs of the images, at the current alignment</p>
<ul>
<li>X: Intensity in Image 1</li>
<li>Y: Intensity in Image 2</li>
<li>Z or colour: Amount of pixels in this bin</li>
</ul>
<h4 id="mean-squared-differences">Mean squared differences</h4>
<h5 id="assumption">Assumption</h5>
<ul>
<li>There is a <u>one-to-one relationship</u> between the intensity distributions <span class="math display">\[
D_{MSD}(f(x),g(T_{\mu}(x)))=\sum_{x∈\Omega}\frac{(f(x)-g(T_{\mu}(x)))^2}{N_{\Omega}}
\]</span></li>
</ul>
<h5 id="use">Use</h5>
<ul>
<li><strong>Mono-modal</strong> registration, of quantitative modalities</li>
<li>Images of the same patient at a different time, or motion estimation in 4D imaging</li>
</ul>
<h5 id="drawbacks-and-advantages">Drawbacks and advantages</h5>
<ul>
<li><strong>Fast</strong> and <strong>simple</strong> relationship</li>
<li>Assumption may quickly become invalid because of artifacts, noise, changes in imaging settings</li>
</ul>
<h4 id="normalized-correlation-coefficient">Normalized correlation coefficient</h4>
<h5 id="assumption-1">Assumption</h5>
<ul>
<li>There is a <strong>linear relationship</strong> between the intensity distributions <span class="math display">\[
D_{NCC}(f(x),g(T_{\mu}(x)))=\sum_{x∈\Omega}\frac{(f(x)-m_f)(g(T_{\mu}(x))-m_g}{\sigma_f\sigma_{g}}
\]</span></li>
</ul>
<h5 id="use-1">Use</h5>
<ul>
<li>Maximize</li>
<li>Registration of mono-modal or closely related modalities</li>
<li>Images taking with <u>different acquisition settings</u></li>
</ul>
<h6 id="drawbacks-and-advantages-1">Drawbacks and advantages</h6>
<ul>
<li>Fast and simple relationship</li>
<li>More robust to changes in imaging settings</li>
</ul>
<p><img src="/images/HMS/1937319.png" /></p>
<h4 id="mutual-information">Mutual information</h4>
<p>One to one or linear relationship?</p>
<p><img src="/images/HMS/1937320.png" /></p>
<figure>
<img src="/images/HMS/1937321.png" alt="" /><figcaption>Multi-modal registration: well aligned</figcaption>
</figure>
<figure>
<img src="/images/HMS/1937322.png" alt="" /><figcaption>Multi-modal registration: not aligned</figcaption>
</figure>
<p><img src="/images/HMS/1937323.png" /></p>
<ul>
<li>If a structure
<ul>
<li>has intensity i in image A</li>
<li>and has intensity j in image B</li>
</ul></li>
<li>In case of good alignment of A &amp; B
<ul>
<li>We should get a peak at <strong><code>(i,j)</code></strong> in the joint histogram</li>
</ul></li>
<li>Considering many structures
<ul>
<li>We should get <strong>many peaks</strong></li>
<li>Instead of an <strong>evenly spread joint histogram</strong></li>
</ul></li>
</ul>
<h5 id="entropy">Entropy</h5>
<h6 id="definition">Definition</h6>
<ul>
<li>An important measure in information theory
<ul>
<li>Claude Shannon, 1948, Bell Labs</li>
</ul></li>
<li>Measures the <strong>uncertainty</strong>, or unpredictability of the state –</li>
<li>Equivalently, represents its average information content, the amount of <u>uncertainty taken away</u> by knowing the variable</li>
</ul>
<p>Consider a discrete stochastic variable X, with n possible values</p>
<ul>
<li><p>Suppose the distribution of X is known <span class="math display">\[
p(x_1)\ for\ i = 1,2,...,n
\]</span></p></li>
<li><p>The entropy of X <span class="math display">\[
H(X)= - \sum_{i}p(x_i)\log p(x_i)
\]</span></p></li>
<li><p>The conditional entropy <span class="math display">\[
H(X|Y)=-\sum_{i}p(x_i)H(Y|X=x_i)
\]</span></p></li>
</ul>
<p><img src="/images/HMS/1937324.png" /></p>
<p>Example for a variable with 2 values {0,1}, for instance a coin toss</p>
<ul>
<li>Entropy is maximal if p= 0.5</li>
<li>Quickly decreases for other values</li>
</ul>
<h6 id="intuition">Intuition</h6>
<p>Has to do with the complexity of an image</p>
<ul>
<li><p>The chance of having an intensity i in image f is p（i<sub>f</sub>） <span class="math display">\[
H(f)= - \sum_{i}p(i_f)\log p(i_f)
\]</span></p>
<ul>
<li>Simple images lead to low entropy</li>
<li>Images with a lot of content will have higher entropy</li>
</ul></li>
</ul>
<p>What is the entropy of an image ?</p>
<ul>
<li>With all white voxel values?</li>
<li>With all black voxel values?</li>
<li>With all intensity values equally used?</li>
</ul>
<h6 id="joint-entropy-intuition">Joint entropy: intuition</h6>
<p>Has to do with the match between two images <span class="math display">\[
H(f,g)= - \sum_{i,j}p(i_f,j_g)\log p(i_f,j_g)
\]</span></p>
<ul>
<li>Few peaks with high probability leads to low H</li>
<li>Many scattered, low peaks correspond to high H</li>
</ul>
<p>What is the joint entropy ?</p>
<ul>
<li>If f and g only have 1 intensity which overlaps?</li>
<li>If all voxel values in f match 1 intensity in g, for example the background?</li>
<li>If all voxel values in f match many intensities in g?</li>
</ul>
<h4 id="mutual-information-1">Mutual information</h4>
<p>A statistical relation between two images A &amp; B, maximizes the mutual information <span class="math display">\[
D_{MI}(f,g)=H(f)+H(g)-H(f,g)
\]</span></p>
<blockquote>
<p>With the computation of all entropies H over the overlapping region Ω</p>
</blockquote>
<ul>
<li>Good match between A&amp;B
<ul>
<li>Low joint entropy</li>
</ul></li>
<li>Map onto complex parts of the images
<ul>
<li>High marginal entropy</li>
<li>Avoid solutions with no overlap or overlap with background</li>
</ul></li>
</ul>
<h6 id="assumption-2">Assumption</h6>
<p>There is a <strong>statistical relationship</strong> between the intensity distributions <span class="math display">\[
D_{MI}(f(x),g(T_{\mu}(x)))=H(f)+H(T_{\mu}(g))-H(f,T_{\mu}(g))|_\Omega
\]</span></p>
<ul>
<li><code>H(f)</code> is the marginal entropy</li>
<li><code>H(f,g)</code> is the joint entropy</li>
<li>All measures are computed over the overlapping region Ω</li>
</ul>
<h6 id="use-2">Use</h6>
<p>Registration of <strong>multi-modal</strong> or interpatient data</p>
<h6 id="drawbacks-and-advantages-2">Drawbacks and advantages</h6>
<ul>
<li>Computationally intensive</li>
<li>Allows to capture very general relationships</li>
</ul>
<h3 id="optimizers">Optimizers</h3>
<h4 id="how-to-find-the-optimal-transformation">How to find the optimal transformation?</h4>
<p>The formulation <code>arg</code> <code>min</code> <span class="math display">\[
\hat\mu = \arg\min_{\mu}C_{x ∈\Omega}(f(x),g(T_{\mu}(x)))
\]</span></p>
<ul>
<li>Implies an <strong>optimization problem</strong></li>
</ul>
<p>Optimizers need to be used that allow to</p>
<ul>
<li>Find the best solution of T over its parameters <strong>μ</strong></li>
<li>Given a cost function （objective or fitness function） C</li>
<li><strong>μ</strong> may have 10<sup>5</sup>sup&gt;-10<sup>7</sup> amount of parameters in case of deformable registration</li>
</ul>
<h4 id="finding-a-minimum-or-maximum">Finding a minimum （or maximum）?</h4>
<ul>
<li><p>How to find these optimal parameters? <span class="math display">\[
\hat\mu = \arg\min_{\mu}C_{x ∈\Omega}(f(x),g(T_{\mu}(x)))
\]</span></p></li>
<li><p><strong>Full search?</strong></p>
<ul>
<li>Try all values of μ</li>
<li>Keep the one for which C is lowest</li>
</ul></li>
<li><p>In practice, not feasible</p>
<ul>
<li>Parameters often have floating point representation, infinite possibilities</li>
<li>Defining a grid search would not work either in high-dimensional search spaces</li>
</ul></li>
</ul>
<h5 id="direct-search-methods">Direct search methods</h5>
<p>No gradient information? <strong>Direct search methods</strong></p>
<ul>
<li>Try several values of μ</li>
<li>Keep those for which C is lowest</li>
<li>Propose new values of μ near the previously found （according to some scheme）</li>
<li>Stop after a certain amount of steps, or when it does not improve anymore</li>
</ul>
<p>Could be preferred when</p>
<ul>
<li>Gradient of C can not be computed or is costly</li>
</ul>
<p>In practice, not feasible for high-dimensional search spaces</p>
<p><strong>Example: Nelder-Mead or simplex</strong></p>
<ul>
<li>A simplex
<ul>
<li>A N+1 polytope in an N-dimensional space</li>
<li>E.g. a triangle in 2d space</li>
</ul></li>
<li>Evaluate N+1 solutions, and update worst, using</li>
</ul>
<p><img src="/images/HMS/1937325.png" /></p>
<h5 id="gradient-descent-methods">Gradient-descent methods</h5>
<p>Gradient information? <strong>Gradient-descent methods</strong></p>
<ul>
<li><p>Find the values μ for which</p>
<ul>
<li><p><span class="math display">\[
∇_{\mu}C=0
\]</span></p>
<blockquote>
<p>extrema of the function C</p>
</blockquote></li>
</ul></li>
<li><p>Two options</p>
<ul>
<li>Either you can solve that equation <strong>analytically</strong> （usually not the case for registration）</li>
<li>Or you have to <strong>iteratively approximate</strong> the optimal value</li>
</ul></li>
</ul>
<p>Many variants exist, but basic principle is:</p>
<ul>
<li>For current （initial） solution μ<sub>i</sub>, compute ∇<sub>μ</sub>C（μ<sub>i</sub>）（gradient with μ components）</li>
<li>Choose a step size η<sub>i</sub>
<ul>
<li>Usually also some way to adapt it over time</li>
</ul></li>
<li>Take a step in the direction of the negative gradient （minimisation μ<sub>i+1</sub> = μ<sub>i</sub> − η<sub>i</sub>∇<sub>μ<sub>i</sub></sub>C</li>
<li>Stop when converge criteria have been reached - Amount of steps / iterations, C does not improve anymore, ||∇<sub>μ</sub>C（μ<sub>i</sub>）|| becomes small, etc.</li>
</ul>
<h4 id="principle-of-an-iterative-gradient-descent-optimizer">Principle of an （iterative） gradient-descent optimizer</h4>
<p><img src="/images/HMS/1937326.png" /></p>
<h3 id="case-studies">Case studies</h3>
<h4 id="applications">Applications</h4>
<ul>
<li>Visualization
<ul>
<li>Facilitate <strong>visual comparison</strong> of two or more datasets</li>
</ul></li>
<li>Diagnosis
<ul>
<li><strong>Combining information</strong> from multiple imaging modalities</li>
</ul></li>
<li>Disease progression
<ul>
<li><strong>Monitoring changes</strong> in size, shape, position or image intensity over time</li>
</ul></li>
<li>Image-guided interventions
<ul>
<li><u>Relating pre-operative images or treatment plans</u> to the physical reality of the patient in his current position</li>
</ul></li>
</ul>
<h4 id="examples">Examples</h4>
<p>MR and CT images of the head of the same patient, taken at approximately the same time</p>
<p><img src="/images/HMS/1937327.png" /></p>
<ul>
<li>Transform?
<ul>
<li>Rigid registration should suffice</li>
<li>No deformations in the skull</li>
</ul></li>
<li>Metric?
<ul>
<li>Very different modalities.</li>
<li>Multi-modal metric such as MI</li>
</ul></li>
</ul>
<p><img src="/images/HMS/1937330.png" /></p>
<ul>
<li>Transform?
<ul>
<li>Good initialization based on prior knowledge of US acquisition</li>
<li>Rigid registration</li>
</ul></li>
<li>Metric?
<ul>
<li>Very different modalities.</li>
<li>Multi-modal metric such as MI</li>
<li>Better metrics needed</li>
</ul></li>
</ul>
<h5 id="mr-ct-registration">MR-CT Registration</h5>
<p><img src="/images/HMS/1937328.png" /></p>
<h5 id="pet-ct-registration">PET-CT registration</h5>
<p><img src="/images/HMS/1937329.png" /></p>
<ul>
<li>Transform?
<ul>
<li>Rigid registration</li>
<li>（optional） Affine</li>
<li>Deformable registration</li>
</ul></li>
<li>Metric?
<ul>
<li>Very different modalities.</li>
<li>Multi-modal metric such as MI</li>
</ul></li>
</ul>
<h4 id="atlas-based-segmentation">Atlas-based segmentation</h4>
<p><img src="/images/HMS/1937331.png" /></p>
<h4 id="multi-atlas-segmentation">Multi-atlas segmentation</h4>
<p><img src="/images/HMS/1937332.png" /></p>
<h4 id="how-to-get-the-final-segmentation">How to get the final segmentation?</h4>
<p>The value of each voxel in the probability map corresponds to the number of atlas for which that voxel belongs to the segmentation, normalized by the total number of atlases used.</p>
<p>Probability map and majority voting</p>
<p><img src="/images/HMS/1937333.png" /></p>
<h2 id="medical-image-visualization">Medical Image Visualization</h2>
<h3 id="introduction-1">Introduction</h3>
<h4 id="goal-of-visualization">Goal of visualization</h4>
<ul>
<li>Medical image data is often 3D
<ul>
<li>Requires inspecting <strong>multiple slices</strong></li>
</ul></li>
<li>Anatomical structures or pathologies are 3D
<ul>
<li>Need for inspecting images in <strong>different orthogonal planes</strong></li>
</ul></li>
<li>Tomographic visualisation can hamper the correct interpretation of the 3D scene
<ul>
<li>Need for 3D <strong>volume or surface rendering</strong></li>
</ul></li>
<li><u>Visualisation techniques are designed to <strong>aid the visual assessment</strong> of the medical image data</u></li>
</ul>
<h4 id="orthogonal-planes">Orthogonal planes</h4>
<p>Standard <strong>reference planes in anatomy</strong></p>
<ul>
<li>The sagittal plane</li>
<li>The coronal plane</li>
<li>The transverse or axial plane</li>
</ul>
<p><img src="/images/HMS/1937334.png" /></p>
<h3 id="visualization-of-3d-images">Visualization of 3D images</h3>
<h4 id="d-orthogonal-visualization-using-mpr">3D orthogonal visualization using MPR</h4>
<ul>
<li>Using MPR
<ul>
<li>Multi-planar reconstruction</li>
</ul></li>
<li>All body planes can be visualized
<ul>
<li><strong>Simultaneous inspection</strong> of different planes</li>
</ul></li>
<li><strong>Synchronised</strong> views
<ul>
<li>Cursor / cross hair indicates same point in space</li>
</ul></li>
</ul>
<h4 id="maximum-intensity-projections">Maximum Intensity projections</h4>
<ul>
<li>2D representation of 3D image data
<ul>
<li>Take maximum along a certain （projection） direction</li>
<li>Only display maximum value</li>
</ul></li>
<li>Variants
<ul>
<li>Can be taken from rotating views</li>
<li>Can be taken over time （e.g. 4D CT）</li>
</ul></li>
<li>Applications
<ul>
<li>Visualisation of contrast</li>
<li>Modalities with strong contrasting properties</li>
<li>Overview of a dataset</li>
</ul></li>
</ul>
<h4 id="volume-rendering">Volume rendering</h4>
<ul>
<li>Visualization and graphics technique
<ul>
<li>Directly renders data using a reasonable approximation to a <strong>physical light transport model</strong></li>
</ul></li>
<li>Assign <strong>optical</strong> and <strong>material</strong> properties to data
<ul>
<li>Colour, opacity, texture</li>
<li>Add a light source</li>
<li>Compute shading, reflection</li>
</ul></li>
<li>Perform <strong>ray-tracing</strong> to construct 2D image
<ul>
<li>Realistic representation of the outer appearance of 3D structures</li>
</ul></li>
</ul>
<h5 id="ray-tracing">Ray tracing</h5>
<p>Image generation technique</p>
<ul>
<li>Trace the path of light through pixels of the image plane
<ul>
<li>View rays for each pixel of the 2D object to the scene</li>
</ul></li>
<li>Simulate the effect of texture and lightning on the virtual objects
<ul>
<li>Texture will determine the appearance of the surface （specular or diffuse reflection）</li>
<li>Shadow rays allow to determine whether the we should visualize shadow or reflection</li>
</ul></li>
</ul>
<p><img src="/images/HMS/1937335.png" /></p>
<h3 id="image-fusion">Image fusion</h3>
<ul>
<li>Combining relevant information from two or more images into a single image or reference frame</li>
<li>Types of fusion
<ul>
<li>Colour overlay</li>
<li>Synced views</li>
<li>Colour fusion</li>
</ul></li>
<li>Accurate fusion may require prior registration of the images</li>
</ul>
<h4 id="colour-overlay">Colour overlay</h4>
<ul>
<li>Overlay <strong>different modalities</strong> using different look-up tables
<ul>
<li>Gray-level LUT</li>
<li>Full colour or single tone LUT</li>
</ul></li>
<li>Suitable transparency and threshold
<ul>
<li>Adapt visibility of the overlaying modality</li>
</ul></li>
<li>Systematically used for <strong>hybrid imaging</strong>
<ul>
<li>PET-MRI, PET-CT</li>
<li>Anatomical imaging provided in gray-level</li>
<li>Functional imaging provided in colour overlay</li>
</ul></li>
</ul>
<h4 id="synchronized-visualisation">Synchronized visualisation</h4>
<ul>
<li>Visualize <strong>spatially aligned images</strong> side-by side, and synchronize navigation
<ul>
<li>Cursor / cross hair indicates same point in space</li>
<li>Multiple body planes can be shown simultaneously</li>
</ul></li>
<li>Fusion of information in clinicians head
<ul>
<li>Both images optimally visible</li>
</ul></li>
<li>Systematically used for <strong>follow-up imaging</strong>
<ul>
<li>PET-CT, contrast-enhanced-CT, MRI,…</li>
<li>Multiple exams taken over time to monitor disease progression</li>
</ul></li>
</ul>
<h4 id="colour-fusion">Colour fusion</h4>
<p>Overlay <u>different images of the same modality</u> using complementary additive colours</p>
<ul>
<li>Blue - Yellow</li>
<li>Red - Cyan</li>
<li>Green- Magenta</li>
</ul>
<p>Suitable transparency and threshold</p>
<ul>
<li>Adapt visibility of the overlaying modality</li>
</ul>
<p><strong>Highlight differences</strong> between similar images</p>
<ul>
<li>Highlight motion in frames of 4D imaging</li>
<li>Highlight misalignment / error after registration</li>
</ul>
<h1 id="summary">Summary</h1>
<h2 id="image-registration">Image registration</h2>
<ul>
<li><p>Aligning two images</p>
<ul>
<li>So that <strong>corresponding coordinate points</strong> in the two images correspond to the <strong>same physical region</strong> of the scene being imaged</li>
</ul></li>
<li><p>Registration is the task of spatially aligning images, and fusion consists of （simultaneously） visualizing images</p></li>
<li><p>Sometimes also referred to as</p>
<ul>
<li>Image fusion, superimposition, matching or merging</li>
</ul></li>
<li><p>To avoid confusion, we define</p>
<ul>
<li><strong>Registration</strong>: the task of spatially aligning images</li>
<li><strong>Fusion</strong>: the task of （simultaneously） visualizing images</li>
</ul></li>
<li><p>Registration has many applications, including</p>
<ul>
<li>Facilitate visual comparison of two or more datasets</li>
<li>Visually combining information from multiple imaging modalities</li>
<li>Monitoring changes in size, shape, position or image intensity over time</li>
<li>Image-guided interventions</li>
</ul></li>
<li><p>Find the spatial coordinate transformation T, under which anatomical structures become aligned</p></li>
<li><p>Mathematically. Registration comes down to solving the equation <span class="math display">\[
\hat\mu = \arg\min_{\mu}C_{x ∈\Omega}(f(x),g(T_{\mu}(x)))
\]</span></p>
<ul>
<li>Find the transformation parameters μ for which the cost function C , computed over the overlapping coordinate positions x of the fixed and moving image, becomes minimal</li>
<li>Typically, an iterative optimization problem （usually using a gradient descent）</li>
</ul></li>
<li><p>Configuring a registration comes down to selecting the correct components, and their parameters</p>
<ul>
<li>Interpolation, computing intensities of the moving image at transformed positions</li>
<li>Cost function / metric, evaluating the goodness of current solution</li>
<li>Optimizer, proposing new transformation parameters</li>
<li>Transform, defining the nature of the mapping, and the parameters to be optimized</li>
</ul></li>
</ul>
<h2 id="image-interpolation">Image Interpolation</h2>
<ul>
<li>Computing intensities of the moving image at transformed positions
<ul>
<li>Reconstruct an intensity value for all image positions</li>
</ul></li>
<li>Different possibilities exist
<ul>
<li>Employ more elaborate models, yield different quality, and have a different associated computational cost</li>
</ul></li>
<li>Nearest neighbour interpolation
<ul>
<li>Just look for the nearest pixel, and use that intensity</li>
</ul></li>
<li>Linear interpolation （continuous）
<ul>
<li>Linearly interpolate the intensity between the nearest 2 （1D）, 4 （2D） or 8 （3D） voxels</li>
</ul></li>
<li>B-spline interpolation （continuous and smooth）
<ul>
<li>Interpolate the intensity by including also values from further pixels, to allow smoothness to a certain degree</li>
</ul></li>
</ul>
<h2 id="image-transformation">Image Transformation</h2>
<ul>
<li>A spatial coordinate transformation applied to the moving image, such that it matches the fixed image</li>
<li>The parameters of the transformation are the ones being optimized during registration
<ul>
<li>The optimal transformation is the result of the registration</li>
</ul></li>
<li>Rigid transformation
<ul>
<li>Rotations and translations</li>
<li>6 degrees of freedom in 3D</li>
</ul></li>
<li>Affine transformation
<ul>
<li>Rotations, translations, differential scaling and shear</li>
<li>12 degrees of freedom in 3D</li>
</ul></li>
<li>Deformable transformation
<ul>
<li>Often parametrized using B-splines to obtain continuous and smooth transformations</li>
<li>Many parameters （depends on the choice of the grid of control points）</li>
</ul></li>
</ul>
<h2 id="similarity-metrics-1">Similarity metrics</h2>
<ul>
<li>A measure computed to assess the similarity of the images, based on the current overlap</li>
<li>Drives the registration, as it determines how good the transformation is
<ul>
<li>And in which direction it may improve</li>
</ul></li>
<li>Mean squared differences
<ul>
<li>Assumes a one-to-one relation between intensity distribution of the images</li>
<li>Mainly used for monomodal, intra-patient registration</li>
</ul></li>
<li>Normalised correlation coefficient
<ul>
<li>Assumes a linear relation between intensity distribution of the images</li>
<li>Mainly used for registration of related modalities or inter-patient registration</li>
</ul></li>
<li>Mutual information
<ul>
<li>Assumes a statistical relation between intensity distribution of the images</li>
<li>Allows to capture very general relations: multi-modal registration</li>
</ul></li>
</ul>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Chaoqun Yin</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://yintelligence.tech/2021/04/20/2021-04-20-Registration-and-Visualisation/">https://yintelligence.tech/2021/04/20/2021-04-20-Registration-and-Visualisation/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint polocy. If reproduced, please indicate source
                    <a href="/about" target="_blank">Chaoqun Yin</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Biomedical-Signals-and-Images/">
                                    <span class="chip bg-color">Biomedical Signals and Images</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2021/04/21/2021-04-21-Naive-Bayes-introduction/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/11.jpg" class="responsive-img" alt="Naive Bayes introduction">
                        
                        <span class="card-title">Naive Bayes introduction</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            A historical background of AI
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-04-21
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Artificial-Intelligence/" class="post-category">
                                    Artificial Intelligence
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Techniques-of-Artificial-Intelligence/">
                        <span class="chip bg-color">Techniques of Artificial Intelligence</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/04/19/2021-04-19-Evolution-of-telecommunications/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/11.jpg" class="responsive-img" alt="Evolution of telecommunications">
                        
                        <span class="card-title">Evolution of telecommunications</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            在本介绍性章节中，将通过电信的历史演变，介绍一些主要概念。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-04-19
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Network/" class="post-category">
                                    Network
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Advanced-IT-Networks/">
                        <span class="chip bg-color">Advanced IT Networks</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + 'From: Chaoqun Yin<br />'
            + 'Author: Chaoqun Yin<br />'
            + 'Link: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>



    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">Chaoqun Yin</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2021";
                    var startMonth = "1";
                    var startDate = "28";
                    var startHour = "2";
                    var startMinute = "1";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/yintelligence" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:Yintelligence@outlook.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
