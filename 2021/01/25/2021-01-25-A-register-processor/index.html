<!DOCTYPE HTML>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="A register processor, Chaoqun Yin">
    <meta name="description" content="Veni, Vidi, Vici">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>A register processor | Chaoqun Yin</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.3.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Chaoqun Yin</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Index</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>Contact</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>Friends</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Chaoqun Yin</div>
        <div class="logo-desc">
            
            Veni, Vidi, Vici
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			About
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			Friends
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/4.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">A register processor</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Computer-Systems/">
                                <span class="chip bg-color">Computer Systems</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Computer-Systems/" class="post-category">
                                Computer Systems
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2021-01-25
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>Update Date:&nbsp;&nbsp;
                    2021-09-01
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp;
                    5.8k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>Read Times:&nbsp;&nbsp;
                    22 Min
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="a-register-processor">A register processor</h1>
<p><a href="https://yintelligence.tech/2021/01/15/2021-01-15-Computer-Systems/">VUB 4004876EER Computer Systems</a> + <a target="_blank" rel="noopener" href="https://vub.cloud.panopto.eu/Panopto/Pages/Viewer.aspx?id=566d17c5-5074-4654-8189-ac4200e4935c">Video</a> + <a target="_blank" rel="noopener" href="https://canvas.vub.be/courses/20575/files?preview=564891">Slide</a></p>
<p>在前一章中，我们可以看到stack架构非常适合管理activation block和评估expression，但我们也看到在某些时候，例如在执行<code>for</code>循环期间，stack组织可能会非常受限。</p>
<p>本章将介绍<strong>寄存器register</strong>体系结构。这种架构可以模拟有用的堆栈架构，但也避免了由stack刚性rigidity引起的heaviness。</p>
<p>完全可以像在前一章中所做的那样描述这个processor（这甚至是检查对这两章理解的极好练习），但这里将使用另一种更接近processor物理现实的方法。该方法描述了数据可以通过的所有计算机设备，并及时分析这些传输。</p>
<p>上一章和这一章使用的描述是互补的，第一个更abstract，本质上是为了理解instruction set的logic，而不考虑speed of execution，而第二个更具体，不仅考虑 logic of the instructions以及它们执行的时间顺序temporal sequence。</p>
<h2 id="block-diagram-of-rp1">1. Block diagram of RP1</h2>
<p>处理器 RP1 在商业上x并不存在，但它的架构被简化为说明architectural concept所需的最低限度，其灵感来自于摩托罗拉68000系列。</p>
<p><img src="C:\Users\heart\Desktop\Blog\source\images\HMS\0917480.png" /></p>
<p>从左到右，我们可以看到 - 一组八个registers，称为 D0 到 D7，旨在包含数据 - 一个算术单元arithmetic unit (ALU)，其输入端有两个临时register T1 和 T2。 - CC register：用于保存算术结果属性 - 控制单元control unit (CU) 及其instruction register (IR) - 增加或减少地址的additional arithmetic unit - 一组 8 个register来保存地址，称为 A0 到 A7；在最后三个register A 中具有特定的功能。因此，A7，也称为PC 是程序计数器program counter，它保存下一条要执行的指令的地址。 - 中央计算机memory。</p>
<p>所有这些组件都通过两条“bus”互连，这些是将 register的内容传输到另一个的线组。RP1 中存在的两种<strong>总线bus</strong>是：</p>
<ul>
<li>红线代表data线；</li>
<li>绿线代表address线；</li>
</ul>
<p>除了bus外，还有许多电线从CU连接到不同的计算机部件。这些电线允许CU传输其命令。</p>
<h3 id="memory-cycle">1.1 Memory cycle</h3>
<p>要描述内存和 CPU 之间的传输，我们必须首先考虑决定所有计算机操作时序的时钟。该时钟是CU的一部分，定义了称为“<strong>时钟周期clock cycle</strong>”的固定时间间隔。</p>
<p>在现代计算机中，时钟时间的持续时间为纳秒nanosecond级。主存储器main memory中的写或读操作需要几个clock cycle。所需clock cycle的总和称为“<strong>存储器周期memory cycle</strong>”。</p>
<p><img src="/images/HMS/0917481.png" /></p>
<h4 id="read-cycle">1.1.1 Read cycle</h4>
<p>一个典型的read cycle如下：</p>
<ul>
<li><p>在时间t<sub>1</sub>，要读取的数据的地址从A寄存器之一通过地址总线发送到存储器，并且控制单元向存储器发送读取命令。</p>
<p>At time t<sub>1</sub>, the address of the data to be read is sent from one of the A registers to the memory via the address bus and a read command is sent by the control unit to the memory.</p></li>
<li><p>在时间 t<sub>2</sub>，控制单元向存储器询问读取操作的状态。如果准备就绪，继续执行 t<sub>3</sub>。否则，在控制单元再次向存储器询问状态之前，控制单元插入等待时间t<sub>w</sub>。</p>
<p>At time t<sub>2</sub>, the control unit asks the memory the status of the read operation. If ready, proceed to t<sub>3</sub>. Otherwise, the control unit inserts a waiting time t<sub>w</sub> before the control unit asks again the memory for a status.</p></li>
<li><p>在时间t<sub>3</sub>读取操作完成，读取值通过数据总线传输到中央处理寄存器。</p>
<p>At time t<sub>3</sub> the read operation is completed by the transfer of the read value via the data bus to a central processing register.</p></li>
</ul>
<h4 id="write-cycle">1.1.2 Write cycle</h4>
<p><img src="/images/HMS/0917482.png" /></p>
<ul>
<li><p>Write cycle从时间 t<sub>1</sub> 开始，在此期间地址被放置在总线地址上，数据总线上的数据和写命令由控制单元给出。</p>
<p>A write cycle begins with a time t<sub>1</sub> during which the address is placed on the bus addresses, the data on the data bus and a write command is given by the control unit.</p></li>
<li><p>剩余的内存周期部分由内存用于执行写入操作，部分由控制单元在每个时钟周期检查内存状态。</p>
<p>The rest of the memory cycle is used partly by the memory to execute the write operation and partly by the control unit checking the memory status at each clock cycle.</p></li>
<li><p>写周期也以时钟周期 t<sub>3 </sub>结束，在此期间，这里描述的任何事情都不会发生。</p>
<p>A write cycle also ends with a clock cycle t<sub>3</sub>, during which nothing here described happens.</p></li>
</ul>
<p>如果我们考虑访问时间约为 50ns 的普通存储器，我们会理解每次读取操作都会插入许多等待时间t<sub>w</sub>。 <u>这一发现有助于解释为什么clock speed不是计算机性能的一个糟糕指标，因为clock speed的增加可能具有增加插入每个memory cycle的次数 t<sub>w</sub> 的主要影响。</u></p>
<h2 id="instructions">2. Instructions</h2>
<h3 id="data-handling">2.1 Data handling</h3>
<table>
<colgroup>
<col style="width: 17%" />
<col style="width: 82%" />
</colgroup>
<thead>
<tr class="header">
<th>DD , DX , Dy</th>
<th>Add contents of Dy to contents of Dx</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SUB , Dx , Dy</td>
<td>Subtract contents of Dy from contents of Dx</td>
</tr>
<tr class="even">
<td>MUL , DX , D</td>
<td>Multiply contents of Dx by contents of Dy</td>
</tr>
<tr class="odd">
<td>DIV , DX , Dy</td>
<td>Divide contents of Dx by contents of Dy</td>
</tr>
<tr class="even">
<td>CMP . DX . D</td>
<td>Compare contents of Dx and Dy , adiust Condition Code Registers accordingly</td>
</tr>
<tr class="odd">
<td>ADI , Rx , a</td>
<td>Add a constant to contents of Rx</td>
</tr>
</tbody>
</table>
<p>RP1 数据处理指令对处理器register中的数据进行操作。对于大多数指令，这是专门用于 Dx 数据寄存器data register的，但对于某些指令，也允许使用 Ax 地址寄存器address register。该纬度通过使用 Rx 符号表示 Dx 或 Ax。 RP1 数据处理指令有两个字段field来引用操作数operand，操作的结果被系统地重定位relocate到第一个 operand所在的位置。</p>
<p>除了四个算术运算之外，RP1 还有一条CMP 比较指令compare instruction，它实际上与减法运算相同，但不会用结果替换第一个operand。算术运算结果的属性记录在 CC register中。所有其他信息处理指令都是如此。</p>
<p>最后，有一条指令，ADI，它可以将一个常量constant的值添加到任何数据或地址寄存器的内容中，以代替指令中第二个operand的引用。</p>
<h4 id="pipelining">2.1.1 Pipelining</h4>
<p>ADD Dx, Dy 是只需要一个memory cycle并引入重要架构概念的指令 ，用于将 Dy 的内容添加到 Dx。</p>
<p><img src="/images/HMS/0917484.png" /></p>
<ul>
<li>前三个clock cycle显然与 LOD 指令 Rx、Ry 所描述的相同，因为要执行的指令的性质仅在 t<sub>3</sub> 结束时才知道。</li>
<li>在 t<sub>4</sub> 时，Dx 的内容被传送到临时寄存器 T1</li>
<li>然后，在 t<sub>5</sub>，Dy 的内容被传送到 T2 寄存器，并向运算单元发出加法命令</li>
<li>通常应该有一个 t<sub>6</sub> 来传输 Dx 中的加法结果。相反，它立即开始执行下一条指令，并利用指令的 t<sub>2</sub> 来传输加法的结果。</li>
</ul>
<p>实际上，在第一个memory cycle指令执行的周期t<sub>1</sub>和t<sub>2</sub>期间，数据总线没有被使用，可以用来终止前一条指令的执行。</p>
<p>一条指令执行结束和下一条指令开始的时间叠加称为“<strong>pipelining</strong>”，是一种在所有现代处理器中广泛使用以提高性能的技术。</p>
<p>This temporal superposition of the end of the execution of one instruction and the beginning of the next is called "<strong>pipelining</strong>" and is a technique that is used extensively in all modern processors to increase performance</p>
<h3 id="data-transfer">2.2 Data transfer</h3>
<table>
<thead>
<tr class="header">
<th>LDI RX . a</th>
<th>load a constant a into Rx</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>LOD . Rx . R</td>
<td>copy value from Ry into Rx</td>
</tr>
<tr class="even">
<td>LOD , Dx , a</td>
<td>copy value from direct address into Dx</td>
</tr>
<tr class="odd">
<td>STO , DX , a</td>
<td>copy value from Dx into direct address</td>
</tr>
<tr class="even">
<td>LOD , DX , Ay, a</td>
<td>copy value from relative address into Dx</td>
</tr>
<tr class="odd">
<td>STO . Dx , Ay, a</td>
<td>copy value from Dx into relative address</td>
</tr>
</tbody>
</table>
<p>在register machine中，需要传输指令transfer instructions来：</p>
<ul>
<li>将常量constant加载到寄存器中（LDI、Rx、a）</li>
<li>将一个寄存器的内容复制到另一个（LOD Rx，Ry）</li>
<li>将一个word的内容从内存复制到一个寄存器中（LOD Dx，...）</li>
<li>将寄存器的内容复制到一个内存word中 (STO Dx, ...)</li>
</ul>
<p>RP1 的体系结构为最后两个transfer instruction类别提供了两个替代transfer instruction来引用memory address</p>
<ul>
<li>Direct addressing直接寻址</li>
<li>Relative addressing:对地址寄存器address register内容的相对寻址</li>
</ul>
<h4 id="data-move">2.2.1 Data move</h4>
<p>这里要分析的第一条指令是LOD Rx, Ry 指令，它将寄存器Ry 的内容复制到寄存器Rx。它只需要一个memory cycle。</p>
<p><img src="/images/HMS/0917483.png" /></p>
<ul>
<li>程序计数器program counter PC 的内容第一次在总线地址上并给出读命令。</li>
<li>第二次，仍然在地址总线上的程序计数器program counter的内容通过与地址寄存器相关联的小算术单元加一，并在 PC 中重写。因此它已经在准备开始执行下一条指令。</li>
<li>在时间 t<sub>3</sub>，可能在经过 tw 次未表示等待的一段时间后，指令从 IR 寄存器中的存储器中传输，以进行解码和执行。直到控制器“知道”指令是什么，指令才被执行。</li>
</ul>
<p>复制 Rx 中 Ry 的内容不需要额外的memory cycle，只需要一个clock cycle来复制临时寄存器 T1 中寄存器 Ry 的内容，第二个clock cycle将这个临时寄存器的内容复制到 Rx 中。T1 和另一个寄存器之间的传输显然都是通过数据总线bus进行的。</p>
<p>由于 8 个 D register 和 8 个 A register 被组织为可寻址addressable存储器，其中每次只能访问一个寄存器，因此无法在没有中间步骤的情况下将 Ry 的内容复制到 Rx 中。</p>
<h4 id="ldi-dx">2.2.2 <code>LDI Dx</code></h4>
<p>LDI Dx c 指令允许将常数 c 加载到 Dx 寄存器中。 它存在两个word，第一个是实际指令，第二个是常量c。</p>
<p><img src="/images/HMS/0917486.png" /></p>
<p>因此它需要<strong>两</strong>个memory cycle。</p>
<ul>
<li>第一个限制为三个clock cycle，并在指令的第一个字加载到 IR 寄存器时结束。</li>
<li>在第二个memory cycle中，PC 增加的内容再次放在地址总线address bus上，并再次增加。 在第二个cycle的t<sub>3</sub>，常量c被内存放在数据总线data bus上，并复制到Dx寄存器中。</li>
</ul>
<p>LDI Dx 指令允许加载存储在 Dx 寄存器中内存地址 <strong>a</strong> 的值。 这是一条很长的两words指令，第一个是实际指令，第二个是地址a。</p>
<p><img src="/images/HMS/0917487.png" /></p>
<p>它需要<strong>三</strong>个memory cycle，两个用于读取指令和读取要传输的值。</p>
<ul>
<li><p>第一个限制为三个clock cycle，并在 IR 寄存器中指令的第一个字时结束。</p></li>
<li><p>在第二个周期中，PC 的内容递增，放在地址总线address bus上，再次递增。</p>
<p>在第二个周期的t<sub>3</sub>，内存地址a的内容被内存放到数据总线data bus上，并复制到A6寄存器，也叫TP。</p></li>
<li><p>在第三个周期中，TP 内容被放置在地址总线address bus上，并向存储器发出读命令。</p>
<p>在第三个周期的 t<sub>3</sub> 处，地址 a 处的存储器中的值已在数据总线data bus上可用并被复制到 Dx 寄存器。</p></li>
</ul>
<h3 id="instructions-for-conditional-jumps">2.3 Instructions for conditional jumps</h3>
<p>除了无条件跳转unconditional jump (JMP) 之外，还可以在control指令中找到一系列用于条件跳转conditional jump的指令。 如第 3.2 章所述，CC 寄存器status of specific bits决定是否执行跳转。</p>
<p>这里只显示了几个用于条件跳转的 RP1 指令。</p>
<table>
<thead>
<tr class="header">
<th>JMP , a</th>
<th>Jump to specified address in code</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>JPA</td>
<td>Jump if the Z condition code is set</td>
</tr>
<tr class="even">
<td>NZ . a</td>
<td>Jump if the Z condition code is clear</td>
</tr>
<tr class="odd">
<td>JPN . a</td>
<td>Jump if the N condition code is set</td>
</tr>
<tr class="even">
<td>JNN . a</td>
<td>Jump if the N condition code is clear</td>
</tr>
<tr class="odd">
<td>JPV . a</td>
<td>Jump if the V condition code is set</td>
</tr>
<tr class="even">
<td>...</td>
<td></td>
</tr>
<tr class="odd">
<td>JSR . a</td>
<td>Call subroutine at specified address in code</td>
</tr>
<tr class="even">
<td>RET</td>
<td>Return from subroutine</td>
</tr>
<tr class="odd">
<td>LNK .Ax</td>
<td>Establish dynamic link with Ax as base</td>
</tr>
<tr class="even">
<td>ULK . A</td>
<td>Restore previous environment using Ax</td>
</tr>
<tr class="odd">
<td>HLT</td>
<td>Stop execution</td>
</tr>
</tbody>
</table>
<p>它们是依赖于位 bit Z (zero), N (negative)和V(overflow during the calculation计算过程中溢出)的那些。</p>
<p>在管理子程序的指令中，显然有调用call子程序subroutine (JSR) 和从子程序subroutine返回 (RET)，但也有管理 dynamic link (LNK 和 ULK) 的指令。</p>
<p>最后，与前一章中描述的stack处理器类似，如果希望为该处理器编写simulator，则有一条 HLT 指令很有用。</p>
<h4 id="cmp-dx-dy">2.3.1 <code>CMP Dx, Dy</code></h4>
<p><img src="/images/HMS/0917485.png" /></p>
<p>CMP Dx, Dy 指令比较 Dx 和 Dy 寄存器中的值。 它需要 5 个时钟周期clock cycle，因此与对 ADD Dx、Dy 指令所描述的完全相同，除了提供给算术单元的命令是 减法而不是加法。</p>
<p><strong>主要区别</strong>是在下一条指令的执行过程中看到的，因为在 t2 算术单元输出处可用的结果没有复制到寄存器中。</p>
<p>CMP Dx, Dy 指令的唯一结果保留在 CC 寄存器中，在每次算术运算时，结果的属性都会报告给该寄存器。</p>
<h3 id="compilation-pattern-expression">2.4 Compilation Pattern: expression</h3>
<p>关于算术指令和传输的解释应该足以理解how an expression can be evaluated in RP1。</p>
<p>D 寄存器将用作stack，可以像在上一章中所做的那样在其上进行表达式求值。</p>
<p><img src="/images/HMS/0917489.png" /></p>
<p>该术语首先以reverse Polish notation重写。 然后编译器将使用 LOD 或 LDI 指令和算术运算符来计算表达式。对于逆波兰表达式 <strong>a 3 + b<sup>*</sup></strong> 程序将首先将 <strong>a</strong> 的值放入寄存器 D0 并将常量 <strong>3</strong> 放入寄存器 <strong>D1</strong>。 然后将 <strong>D1</strong> 的内容添加到 <strong>D0</strong> 的内容中。 之后，将 b 的值放入 <strong>D1</strong> 并乘以 <strong>D0</strong> 的内容，结果保留在 <strong>D0</strong> 中。 然后可以将这个结果存储在内存中的地址 <strong>x</strong></p>
<h3 id="control-flow">2.5 Control flow</h3>
<p>JMP <strong>a</strong> 指令允许无条件跳转到地址 <strong>a</strong>。 该指令有两个word的长度，第一个是实际指令，第二个是需要跳转到的地址。 在执行的第二个存储周期期间，该地址被传送到 TP 寄存器。</p>
<p><img src="/images/HMS/09174810.png" /></p>
<p>然后开始执行下一条指令，但不是在第一个时钟周期内将 PC 内容放在地址总线上，而是将 TP 的内容放在总线上。 在 t<sub>2</sub> 处，对于任何其他执行，小型附加算术单元将地址总线的内容加 1，并将结果放入 PC 寄存器。 这样，程序从包含在无条件跳转语句unconditional jump statement中的地址继续执行。</p>
<p>条件分支conditional branch指令的执行与无条件跳转unconditional jump指令的执行非常相似，一个主要区别是在下一条指令的执行开始处。</p>
<p><img src="/images/HMS/09174811.png" /></p>
<p>在第二个内存周期结束时，TP 寄存器包含如果满足跳转条件将执行的指令的地址，而 PC 寄存器包含条件跳转指令之后的指令的地址，如果满足，它将运行 它不满足跳跃的条件。 因此，此时控制单元根据 CC 寄存器的状态决定是否需要将 TP 或 PC 的内容放置在地址总线上。</p>
<h4 id="compilation-pattern-if">2.5.1 Compilation Pattern: IF</h4>
<p>使用条件和无条件跳转指令可以实现高级语言的常规控制指令。</p>
<p><img src="/images/HMS/09174812.png" /></p>
<p>上面显示了如何将 if 语句转换为汇编程序 RP1。</p>
<p>首先对布尔表达式 B 进行求值，以便求值以计算结束，如果表达式为false，则结果为 0，如果表达式为true，则结果为 1。</p>
<p>在评估 B 之后，如果 B 的值为false，则指令 <strong>JPZ L1</strong> 跳到标签 L1。 另一方面，如果它为true，则执行 S1 的代码。 在此代码无条件跳转到标签 L2 之后，程序的其余部分将继续。S2 的代码位于标签 L1 和 L2 之间。</p>
<h4 id="compilation-pattern-loop">2.5.2 Compilation Pattern: Loop</h4>
<p><img src="/images/HMS/09174813.png" /></p>
<p><code>while ... do</code>循环在汇编器中的翻译很容易。 首先，表达式 B 被评估，如上例所示。 如果 B 的值为假，则 JPZ L2 指令会跳到程序的其余部分。 另一方面，如果 S 的代码确实被执行，并且在它结束时，无条件跳转 JMP L1 会导致重新评估 B。</p>
<p><img src="/images/HMS/09174814.png" /></p>
<p>上面显示的 <code>do..while</code> 语句的翻译产生的代码。 可以看到它以对应于 S 的代码开始，然后是对应于布尔表达式 B 的评估的代码。在此评估之后，如果值 B 为 TRUE，则 JNZ 指令跳到 S 执行的开头，否则 继续程序的其余部分</p>
<p><img src="/images/HMS/09174815.png" /></p>
<p><code>for</code>循环在汇编程序中的转换允许<u>突出register架构相对于stack架构的优势</u>。</p>
<ul>
<li><p>计算第一个表达式 M 和 N，并将它们的值放置在 D0 和 D1 寄存器中。</p></li>
<li><p>CMP D1, D0 指令允许验证是否有必要继续执行 <code>for</code> 循环，或者我们是否可以继续执行程序的其余部分。</p></li>
<li><p>如果 D1 的内容大于 D0，则指令 JPN L1 会跳到程序的其余部分。</p></li>
<li><p>在 JPN 指令之后，执行 S 的代码。</p>
<p>需要注意的是，这段代码不能使用D0和D1寄存器，因为这些是<code>for</code>循环管理所必需的。</p></li>
<li><p>在 S 代码之后，使用 ADI D1,#1 指令递增存储在 D1 寄存器中的变量 a。</p></li>
<li><p>递增 JMP L2 指令后导致返回到循环的开头。</p></li>
</ul>
<p>此代码与stack处理器代码之间的巨大差异在于，<strong>D0 和 D1 仍然可以访问</strong>，而stack处理器<strong>只能访问顶部</strong>，<strong>并且对顶部的任何读取都使其无法访问</strong>。</p>
<h4 id="subroutine-call-instruction">2.5.3 Subroutine call instruction</h4>
<p><img src="/images/HMS/09174816.png" /></p>
<p>子程序调用subroutine call指令最有趣的方面是返回地址 return address的保护机制safeguard mechanism。</p>
<p>在 RP1 中，一部分内存用于构建stack，其中存储返回地址、动态和静态链接、激活块和函数参数。栈顶的地址保存在寄存器A5中，也称为<strong>SP</strong>。</p>
<ul>
<li><p>在前 6 个clock cycle（加上任何等待时间 tw）期间，subroutine call instruction的执行与regular jump instruction的执行完全相同。</p></li>
<li><p>在第二个memory cycle的 t<sub>3</sub> 结束时，可以找到子程序的 TP 地址和 PC 中调用后指令的地址。</p>
<p>第二个memory cycle延长了两个clock cycle，在此期间它递增堆栈指针 SP 的内容，以便它指向堆栈上的第一个可用空间。</p></li>
<li><p>然后开始第三个memory cycle，我们将 PC 寄存器的内容写入 SP 指向的内存中。</p>
<p>在第三个周期结束时，下一条指令开始执行，其地址将在 TP 寄存器而不是 PC 寄存器中找到。</p></li>
</ul>
<p>子程序返回的执行归结为将存储在堆栈中的返回地址移动到程序计数器 PC。</p>
<ul>
<li><p>当在第一个memory cycle结束时识别出 RET 指令时，第二个周期立即开始。</p></li>
<li><p>在t<sub>1</sub>，堆栈指针SP的内容被放置在地址总线上，并带有一个读命令。 在 t<sub>2</sub> 时，堆栈指针的内容减一，在 t<sub>3</sub> 时，返回地址被加载到 TP 寄存器中。</p>
<p>在第二个周期结束后，通过将 TP 的内容放在地址总线上开始执行下一条指令</p></li>
</ul>
<h3 id="dynamic-link-management">2.6 Dynamic link Management</h3>
<p>在上一章介绍的堆栈处理器中，调用和返回指令子程序不仅管理return address，还管理动态和静态链接。</p>
<p>我们看到 RP1 的情况并非如此。 这台计算机有两个特定的指令（LNK 和 ULK）来管理dynamic link。 它没有针对静态链接的具体说明，因为它们的管理通常非常简单。</p>
<p>在堆栈机stack machine的情况下，必须有一个基址寄存器base register。 这里，A4 寄存器将用于此功能。</p>
<p><img src="/images/HMS/09174817.png" /></p>
<p>LNK 指令用于在调用子程序后更新注册表 registry。 它通常是子程序subroutine的第一条指令。</p>
<p><img src="/images/HMS/09174818.png" /></p>
<ul>
<li>LNK 执行的第一个memory cycle有 5 个clock cycle，后两个用于递增increment堆栈指针。</li>
<li>在第二个周期的t<sub>1</sub>，栈指针的内容放在地址总线上，注册表registry的内容放在数据总线上，并给出写命令。</li>
<li>在同一周期的 t<sub>2</sub>，通过将地址总线上的当前值复制到基址寄存器来更新基址寄存器。</li>
</ul>
<p>A0 到 A4 中的任何一个都可以用于该目的，但通常使用的是 A4，留下 A0 到 A3 用于数据索引data indexing目的。</p>
<p><img src="/images/HMS/09174819.png" /></p>
<p>ULK 指令用于在离开subroutine之前恢复堆栈指针和基址寄存器的旧值。</p>
<ul>
<li>在第一个memory cycle的最后两个时钟周期内，将基址寄存器中的值复制到堆栈指针，以释放子程序占用的所有空间。</li>
<li>在第二个周期中，动态链接的值从堆栈中移除并放置在基址寄存器中。</li>
</ul>
<h4 id="procedure-call">2.6.1 Procedure call</h4>
<p><img src="/images/HMS/09174820.png" /></p>
<p>上图显示了 JSR、LNK、ULK 和 RET 指令的使用。在调用函数 P 之前，堆栈指针 SP 指向堆栈上最后使用的字，基址寄存器 A4 指向找到调用 P 的函数的激活块的开始。</p>
<p><img src="/images/HMS/09174821.png" /></p>
<p>调用函数P后，调用后的指令地址（返回地址RA）在栈上。</p>
<p><img src="/images/HMS/09174822.png" /></p>
<p>函数P中的第一条指令是更新基址寄存器A4的LNK A4指令。它将 A4 中的旧值放在返回地址上方的堆栈中，并将此动态链接的堆栈上的地址放入 A4。下面的语句 (ADI SP ...) 递增堆栈指针的内容，为函数 P 的激活块保留空间。</p>
<p><img src="/images/HMS/09174823.png" /></p>
<p>函数 P 的最后一条指令是 ULK A4 指令，它在执行函数 P 开头的 LNK 指令之前恢复 A4 中的前一个值。它还通过放置在 SP 中为函数 P 释放堆栈上的所有空间返回地址的地址。</p>
<p><img src="/images/HMS/09174824.png" /></p>
<p>函数 P 返回后，从返回地址 RA 继续执行，该地址也从堆栈中移除。 （实际上，它仍然在堆栈上，但堆栈指针被递减，它变得几乎不可访问，并将在下一次写入堆栈时被其他数据替换）</p>
<h4 id="procedure-parameters">2.6.2 Procedure parameters</h4>
<p><img src="/images/HMS/09174825.png" /></p>
<p>要完成RP1中调用子程序的学习，还必须考虑参数传递机制。</p>
<h4 id="parameter-passing">2.6.3 Parameter passing</h4>
<p><img src="/images/HMS/09174826.png" /></p>
<p>参数传递在 RP1 中以与在前一章中研究的堆栈处理器中完全相同的方式完成。 参数放置在堆栈上，在调用函数的激活黑色的顶部和返回地址的下方。</p>
<p>对于按值传递的参数，它是放置在堆栈上的参数的当前值，而对于按引用传递的参数，这是它们的地址。与堆栈处理器的唯一区别在于<strong>函数返回的值</strong>。</p>
<p>虽然在堆栈处理器中，在堆栈参数下方为该值保留了一个位置，但通常在数据寄存器中，函数的值在寄存器处理器中返回。</p>
<p><strong>Remark: Simple values returned by functions are often stored in a data register rather than on the stack.</strong></p>
<h2 id="recursive-function-example">3. Recursive function example</h2>
<p>递归函数是可以调用自身的函数。</p>
<p>尽管出于性能原因，不建议递归计算阶乘函数，但我们可以通过一个非常简单的递归示例来实现。</p>
<p>用 C 编写的阶乘函数很简单，因为它从字面上转置了 C 语言中阶乘函数的数学定义</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">int fac(int n)
&#123;
    if (n &gt; 0)
        return n * fac(n-1)
    else
        return 1
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Chaoqun Yin</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://yintelligence.tech/2021/01/25/2021-01-25-A-register-processor/">https://yintelligence.tech/2021/01/25/2021-01-25-A-register-processor/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint polocy. If reproduced, please indicate source
                    <a href="/about" target="_blank">Chaoqun Yin</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Computer-Systems/">
                                    <span class="chip bg-color">Computer Systems</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2021/01/26/2021-01-26-Input--Output-interfaces-&-Interrupts/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/0.jpg" class="responsive-img" alt="Input / Output interfaces &amp; Interrupts">
                        
                        <span class="card-title">Input / Output interfaces &amp; Interrupts</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            本章讨论计算机与外部世界之间的通信。
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-01-26
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Computer-Systems/" class="post-category">
                                    Computer Systems
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Computer-Systems/">
                        <span class="chip bg-color">Computer Systems</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/01/24/2021-01-24-Mathematical-induction,-recursion-and-time-complexities/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/13.jpg" class="responsive-img" alt="Mathematical induction, recursion and time complexities">
                        
                        <span class="card-title">Mathematical induction, recursion and time complexities</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-01-24
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Data-model/" class="post-category">
                                    Data model
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Algorithms-and-Data-Structures/">
                        <span class="chip bg-color">Algorithms and Data Structures</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + 'From: Chaoqun Yin<br />'
            + 'Author: Chaoqun Yin<br />'
            + 'Link: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">Chaoqun Yin</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2021";
                    var startMonth = "1";
                    var startDate = "28";
                    var startHour = "2";
                    var startMinute = "1";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/yintelligence" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:Yintelligence@outlook.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
