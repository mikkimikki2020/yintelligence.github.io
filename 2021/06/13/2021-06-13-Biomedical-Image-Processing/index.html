<!DOCTYPE HTML>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Biomedical Image Processing, Chaoqun Yin">
    <meta name="description" content="Veni, Vidi, Vici">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Biomedical Image Processing | Chaoqun Yin</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.3.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Chaoqun Yin</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Index</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>Contact</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>Friends</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Chaoqun Yin</div>
        <div class="logo-desc">
            
            Veni, Vidi, Vici
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			About
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			Friends
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Biomedical Image Processing</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Biomedical-Signals-and-Images/">
                                <span class="chip bg-color">Biomedical Signals and Images</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Digital-Health/" class="post-category">
                                Digital Health
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2021-06-13
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>Update Date:&nbsp;&nbsp;
                    2021-08-11
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp;
                    2.6k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>Read Times:&nbsp;&nbsp;
                    16 Min
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="biomedical-image-processing">Biomedical Image Processing</h1>
<p><a href="https://yintelligence.tech/2021/01/06/2021-01-06-VUB-4019776DNR-Biomedical-Signals-and-Images/">VUB 4019776DNR Biomedical Signals and Images</a></p>
<p><a target="_blank" rel="noopener" href="https://vub.cloud.panopto.eu/Panopto/Pages/Viewer.aspx?id=ddb4c3bc-9784-4990-b504-ac8e00a74d1e">Video</a></p>
<h2 id="purpose">Purpose</h2>
<p>The purpose of this exercise session is to obtain insight in the image enhancement, filtering and segmentation operations commonly applied in medical image processing.</p>
<h2 id="required-modules">Required modules</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://pypi.org/project/numpy/">numpy</a></li>
<li><a target="_blank" rel="noopener" href="https://scipy.github.io/old-wiki/pages/PyLab">pylab</a></li>
<li><a target="_blank" rel="noopener" href="https://www.scipy.org/getting-started.html">scipy</a></li>
<li><a target="_blank" rel="noopener" href="https://scikit-image.org/docs/dev/api/skimage.html#module-skimage">skimage</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/math.html">math</a></li>
<li><a target="_blank" rel="noopener" href="https://scikit-learn.org/stable/index.html">sklearn</a></li>
<li><a target="_blank" rel="noopener" href="https://matplotlib.org/3.1.1/index.html">Matplotlib</a></li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> skimage <span class="token keyword">import</span> data<span class="token punctuation">,</span> img_as_float
<span class="token keyword">from</span> pylab <span class="token keyword">import</span> show<span class="token punctuation">,</span>title<span class="token punctuation">,</span>figure<span class="token punctuation">,</span>imshow<span class="token punctuation">,</span>subplot<span class="token punctuation">,</span>subplots_adjust<span class="token punctuation">,</span> hist<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="image-enhancement">Image enhancement</h2>
<h3 id="the-image-histogram">The image histogram</h3>
<p>The histogram is a representation of how many pixels have a certain intensity in the corresponding image. Medical images can however have a large intensity range, or even floating point intensities, making the pixel count per intensity low or impractical. In practice, intensities are therefore usually binned, i.e. grouped in a reduced number of bins with similar intensity.</p>
<h3 id="image-enhancement-1">Image enhancement</h3>
<p>We shall discuss two ways of contrast improvement. The first is <a target="_blank" rel="noopener" href="http://homepages.inf.ed.ac.uk/rbf/HIPR2/stretch.htm">linear contrast mapping</a> or <a target="_blank" rel="noopener" href="https://scikit-image.org/docs/dev/auto_examples/color_exposure/plot_equalize.html">histogram stretching</a>, which involves a linear transformation on the image intensities, such that the transformed intensities cover to the full range. Another way to improve the contrast is to perform <a target="_blank" rel="noopener" href="https://scikit-image.org/docs/dev/auto_examples/color_exposure/plot_equalize.html">histogram equalisation</a>. In this case, the aim is to obtain a uniform histogram, in which all intensities are equally represented. This can be done by applying a nonlinear transformation on the image intensities. It can be shown that the transform corresponds to the cumulative histogram.</p>
<h3 id="example-1-linear-contrast-mapping">Example 1: Linear contrast mapping</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Load an example image</span>
low_contrast_image <span class="token operator">=</span> data<span class="token punctuation">.</span>moon<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token string">"contrast stretching (i.e., normalization),"</span>
<span class="token string">"where the image is rescaled to include all intensities that fall within the 2nd and 98th percentiles."</span> 
    
p2<span class="token punctuation">,</span> p98                  <span class="token operator">=</span> np<span class="token punctuation">.</span>percentile<span class="token punctuation">(</span>low_contrast_image <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  

i_min<span class="token punctuation">,</span> i_max             <span class="token operator">=</span> p2<span class="token punctuation">,</span>p98

image_cliping            <span class="token operator">=</span> np<span class="token punctuation">.</span>clip<span class="token punctuation">(</span>low_contrast_image <span class="token punctuation">,</span> i_min<span class="token punctuation">,</span>i_max<span class="token punctuation">)</span>

image_constrast_streched <span class="token operator">=</span> <span class="token punctuation">(</span>image_cliping <span class="token operator">-</span> i_min<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">float</span><span class="token punctuation">(</span>i_max <span class="token operator">-</span> i_min<span class="token punctuation">)</span> 

<span class="token string">"Displaying low contrast image, contrast-enhanced image and their corresponding histogrms"</span>

h<span class="token punctuation">,</span>w<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span>    <span class="token comment"># figure height and width </span>
figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
subplots_adjust<span class="token punctuation">(</span>hspace<span class="token operator">=</span><span class="token number">.2</span><span class="token punctuation">)</span>

subplot<span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
imshow<span class="token punctuation">(</span>low_contrast_image <span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
title<span class="token punctuation">(</span><span class="token string">'Original Low-contrast Image'</span><span class="token punctuation">)</span>

subplot<span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
imshow<span class="token punctuation">(</span>image_constrast_streched<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
title<span class="token punctuation">(</span><span class="token string">'Image after contrast streching/normalization'</span><span class="token punctuation">)</span>

subplot<span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
hist<span class="token punctuation">(</span>img_as_float<span class="token punctuation">(</span>low_contrast_image<span class="token punctuation">)</span><span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bins<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token comment"># plotting histogram of original low-contrast image</span>

subplot<span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>
hist<span class="token punctuation">(</span>image_constrast_streched<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bins<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token comment"># plotting histogram of contrast streched/normalized image</span>
show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="exercise-1.1-linear-contrast-mapping">Exercise 1.1: Linear contrast mapping</h4>
<p>By following above example 1, solve the below exercise.</p>
<ul>
<li><p>Read an image （<a target="_blank" rel="noopener" href="https://canvas.vub.be/courses/18933/files/folder/Practical%20Sessions/WPO3?preview=658541">Brain.tiff</a>）</p>
<blockquote>
<p>hint: user can load the image in different ways, like: <a target="_blank" rel="noopener" href="https://scikit-image.org/docs/dev/api/skimage.io.html#skimage.io.imread">skimage.io.imread</a>, <a target="_blank" rel="noopener" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.imread.html">plt.imread</a>, <a target="_blank" rel="noopener" href="https://pypi.org/project/imread/">imread</a></p>
<p>preferable: from imread import imread. Install imread with pip install imread</p>
</blockquote></li>
<li><p>Perform linear contrast mapping （contrast stretching/normalization）</p></li>
<li><p>Display input image, output image （after linear contrast mapping）, their corresponding histograms with 64 bins in a 2×2 figure.</p></li>
</ul>
<p><strong>Report</strong></p>
<ul>
<li>Look at the output result and its histogram. Compare it with the histogram of the original input image. Comment about difference between them.</li>
</ul>
<h3 id="example-2-histogram-equalisation">Example 2: Histogram equalisation</h3>
<p>Students are suggested to have a look into <a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.histogram.html">np.histogram</a> for a calculation of histogram.</p>
<pre class="line-numbers language-none"><code class="language-none"># Load an example image
# Load an example image
&quot;Load an example image&quot;
image &#x3D; data.moon()

&quot;calculation of histogram&quot;
hist, bin_edges &#x3D; np.histogram(image.ravel(), bins&#x3D;64)
bin_centers &#x3D; (bin_edges[:-1] + bin_edges[1:]) &#x2F; 2
img_cdf &#x3D; hist.cumsum()
img_cdf &#x3D; img_cdf &#x2F; float(img_cdf[-1])
out &#x3D; np.interp(image.flat, bin_centers, img_cdf)
img_eq &#x3D; out.reshape(image.shape)

&quot;Displaying input image, image-histogram equalized and their corresponding histogrms&quot;

h,w&#x3D;2,2    # figure height and width 
figure(figsize&#x3D;(10,10))
subplots_adjust(hspace&#x3D;.2)

subplot(h,w,1)
imshow(image , cmap&#x3D;&#39;gray&#39;)
title(&#39;Original Input Image&#39;)

subplot(h,w,2)
imshow(img_eq, cmap&#x3D;&#39;gray&#39;)
title(&#39;Image after histogram equalization&#39;)

subplot(h,w,3)
pylab.hist(img_as_float(image).ravel(),bins&#x3D;64) #plotting histogram of original image

subplot(h,w,4)
pylab.hist(img_eq.ravel(),bins&#x3D;64)#plotting histogram of histogram-equalized image
show()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="exercise-1.2-histogram-equalization">Exercise 1.2: Histogram equalization</h4>
<p>By following the example 2, solve the below exercise.</p>
<ul>
<li><p>Read an image （<a target="_blank" rel="noopener" href="https://canvas.vub.be/courses/18933/files/folder/Practical%20Sessions/WPO3?preview=658541">Brain.tiff</a>） using <a target="_blank" rel="noopener" href="https://pypi.org/project/imread/">imread</a></p>
<p>eg: from imread import imread</p></li>
<li><p>Perform histogram equalization <a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.histogram.html">np.histogram</a></p></li>
<li><p>Display input image, output image （after linear contrast mapping） of exercise 1.1, output image （histogram-equalized）, their corresponding histograms with 64 bins in a 3×3 figure.</p></li>
</ul>
<p><strong>Report</strong></p>
<ul>
<li>Look at the output results and their histograms. Compare them with the histogram of the original input image. The histogram of the histogram-equalized output image is not perfectly uniform. What is the reason for this?</li>
</ul>
<h2 id="image-denoising">Image Denoising</h2>
<p>Filters are used in medical imaging to enhance or suppress certain features of images. They may be used to improve the image quality before reviewing them, or as a pre-processing step to improve the result of further image processing steps such as segmentation. For many filters, the extent of the neighbourhood considered for each pixel is determined by a spatial filter mask （kernel）. The weights of the mask can be combined with the underlying pixels in a linear way, in which case this comes down to a convolution of the mask and image. Other filters however exist, based on non-linear operations.</p>
<h3 id="noise-suppression">Noise suppression</h3>
<p>An important processing task is the suppression of noise, either for enhanced visualization or for improving the result of further processing. Noise can often be assumed to be a high frequency signal. Many noise reduction approaches are therefore based on attenuating the high frequency components while preserving the low frequency components. A popular linear filter for this purpose is the （2D） Gaussian filter. Low pass filtering for noise suppression has the side effect of blurring the edges of an image, which is often undesirable. Smoothing filters that preserve the edges of an image have therefore been proposed, such as the non-linear median filter.</p>
<h3 id="edge-enhancement">Edge enhancement</h3>
<p>Image filtering can also be used for the enhancement or detection of edges. The goal of such filters is often to enhance the edge contrast of an image in an attempt to improve its apparent sharpness. If the final goal is to retain an edge image, i.e. a binary image in which only the edges are preserved, the operation is termed edge detection. Such images can later on serve as inputs for further image processing steps such as segmentation.</p>
<h4 id="example-3-image-denoising-by-different-filters-i.e-gaussian-filter-median-filter-and-average-filter">Example 3: Image denoising by different filters （i.e, <a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.ndimage.gaussian_filter.html">Gaussian filter</a>, <a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.ndimage.median_filter.html">median filter</a> and <a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.ndimage.convolve.html">average filter</a>）</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">image           <span class="token operator">=</span> misc<span class="token punctuation">.</span>ascent<span class="token punctuation">(</span><span class="token punctuation">)</span>                             <span class="token comment"># load input image</span>
Gaussian_filter <span class="token operator">=</span> ndimage<span class="token punctuation">.</span>gaussian_filter<span class="token punctuation">(</span>image<span class="token punctuation">,</span> sigma <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment"># gaussian filter with standard deviation = 3</span>
median_filter   <span class="token operator">=</span> ndimage<span class="token punctuation">.</span>median_filter<span class="token punctuation">(</span>image<span class="token punctuation">,</span> size <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">)</span>    <span class="token comment"># median filter with kernel size of 7</span>
kernel          <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">18</span>                    <span class="token comment"># define kernel for average filter, kernel size is 6</span>
average_filter  <span class="token operator">=</span> ndimage<span class="token punctuation">.</span>convolve <span class="token punctuation">(</span>image<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span>          <span class="token comment"># average filter </span>

<span class="token string">"displaying original image, results from gaussian, median and average filters"</span>

h<span class="token punctuation">,</span>w<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span>    <span class="token comment"># figure height and width </span>
figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>subplots_adjust<span class="token punctuation">(</span>hspace<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>wspace<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
subplot<span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>imshow<span class="token punctuation">(</span>image<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>title<span class="token punctuation">(</span><span class="token string">'Original image'</span><span class="token punctuation">)</span>
subplot<span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>imshow<span class="token punctuation">(</span>Gaussian_filter<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>title<span class="token punctuation">(</span><span class="token string">'Gaussian Filter'</span><span class="token punctuation">)</span>
subplot<span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>imshow<span class="token punctuation">(</span>median_filter<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>title<span class="token punctuation">(</span><span class="token string">'Median Filter'</span><span class="token punctuation">)</span>
subplot<span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>imshow<span class="token punctuation">(</span>average_filter <span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>title<span class="token punctuation">(</span><span class="token string">'Average Filter '</span><span class="token punctuation">)</span>
show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="example-4-edge-enhancement">Example 4: Edge Enhancement</h4>
<p>Enhancing edge of an image using <a target="_blank" rel="noopener" href="https://scikit-image.org/docs/dev/api/skimage.filters.html#skimage.filters.prewitt">prewitt function</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">image  <span class="token operator">=</span> misc<span class="token punctuation">.</span>ascent<span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment"># load input image</span>
Edge   <span class="token operator">=</span> prewitt <span class="token punctuation">(</span>image<span class="token punctuation">)</span>   <span class="token comment"># find edge</span>

h<span class="token punctuation">,</span>w<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span>                   <span class="token comment"># figure height and width </span>
figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>subplots_adjust<span class="token punctuation">(</span>hspace<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> wspace<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
subplot<span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>imshow<span class="token punctuation">(</span>image<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>title<span class="token punctuation">(</span><span class="token string">'Original image'</span><span class="token punctuation">)</span>
subplot<span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>imshow<span class="token punctuation">(</span>Edge<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>title<span class="token punctuation">(</span><span class="token string">'Edge'</span><span class="token punctuation">)</span>
show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="exercise-2">Exercise 2</h4>
<p>To illustrate image filtering we will try to restore an image, obtained by distorting Brain.tiff with Salt and Pepper noise （<a target="_blank" rel="noopener" href="https://canvas.vub.be/courses/18933/files/folder/Practical%20Sessions/WPO3?preview=658542">Brain_noise_SnP.tiff</a>）. In the first part of the exercise, we will focus on Gaussian smoothing. Apply <a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.ndimage.gaussian_filter.html">Gaussian filtering</a> to the noisy image with a standard deviation of 1.</p>
<ul>
<li>Read input image （<a target="_blank" rel="noopener" href="https://canvas.vub.be/courses/18933/files/folder/Practical%20Sessions/WPO3?preview=658541">Brain.tiff</a>）</li>
<li>Read noisy image （<a target="_blank" rel="noopener" href="https://canvas.vub.be/courses/18933/files/folder/Practical%20Sessions/WPO3?preview=658542">Brain_noise_SnP.tiff</a>）</li>
<li>Apply <a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.ndimage.gaussian_filter.html">Gaussian filtering</a> to the noisy image with a standard deviation of 1.</li>
<li>Calculate the difference image of the input noisy image with the obtained filtered image. The difference you obtain is the filtered noise.</li>
<li>Calculate the difference image of the obtained filtered image with the provided ground truth （<a target="_blank" rel="noopener" href="https://canvas.vub.be/courses/18933/files/folder/Practical%20Sessions/WPO3?preview=658541">Brain.tiff</a>）. The difference you obtain is the noise that remained after filtering （Unfiltered noise）.</li>
<li>Create a simple edge map of the obtained filtered image using the <a target="_blank" rel="noopener" href="https://scikit-image.org/docs/dev/api/skimage.filters.html#skimage.filters.prewitt">edge function and prewitt mask</a>.</li>
<li>Display input image, noisy image, gaussian filtered image, filtered noise and unfiltered noise.</li>
</ul>
<p><strong>Report</strong></p>
<ul>
<li><p>Repeat the process, for a <a target="_blank" rel="noopener" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.ndimage.median_filter.html">median filter</a> for a kernel of size 3 and an average filter using a kernel of size 3. For the average filter you will have to create your own filter kernel.</p></li>
<li><p>Calculate the <a target="_blank" rel="noopener" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.mean_squared_error.html">root mean squared differences （RMSD）</a> of the pixels of the obtained filtered images with those of the ground truth. RMSD is a frequently used measure of the differences between values.</p>
<p>Hint: RMSD = <a target="_blank" rel="noopener" href="https://www.tutorialspoint.com/python/number_sqrt.htm">sqrt</a> （<a target="_blank" rel="noopener" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.mean_squared_error.html">mean_squared_error</a> （input image, filtered image））</p></li>
<li><p>Display a three-by-four plot with the filtered images obtained using the different filters, the filtered noise, the noise that remained after the filtering （unfiltered） and the edge maps of the filtered image.</p></li>
<li><p>Provide all three values for the RMSD between filtered image and the ground truth.</p></li>
<li><p>Comment briefly on the results.</p></li>
<li><p>What is the interpretation of the difference image with the ground truth and the difference image with the original input image?</p></li>
<li><p>Which filter works best in terms of RMSD and why?</p></li>
<li><p>Which filter preserves the edges the best?</p></li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="image-segmentation">Image segmentation</h2>
<p>Segmentation is the task of defining the boundaries of an object or region in an image. It is often used for measuring size or volume of organs or other tissues of interest. A multitude of different methods exist and the optimal choice of segmentation method is highly dependent on the region to be segmented, and the type and quality of the input image.</p>
<h3 id="thresholding">Thresholding</h3>
<p>Image thresholding is the simplest and fastest segmentation method. The process comes down to defining one or more boundaries of intensity in the image histogram. Pixels with intensity within the boundaries will get mapped to 1 （inside）, while others are considered background. The process can be extended to multiple labels using multiple （upper and lower） boundaries. Thresholding can be done by manually selecting the boundaries, or automatically, by optimizing the boundary values with respect to a certain criterion. For instance, Otsu thresholding will automatically select boundaries that maximize the between class variance of two or more regions.</p>
<h3 id="region-growing">Region Growing</h3>
<p>Region growing is an iterative segmentation approach in which an initial region （usually a single seed point） is grown by including its neighbouring pixels if they fulfil certain requirements. In its simplest form, region growing is closely related to thresholding, mainly using the image intensity to drive the algorithm. The algorithm has the benefit of taking into account spatial connectivity, thereby enabling to limit the segmentation to connected regions.</p>
<h3 id="dice-coefficient">Dice Coefficient</h3>
<p>A common way to evaluate segmentations is to compare the obtained object S, with the reference or ground truth R provided by physicians after manual segmentations. A popular measure for quantitative evaluation is computing the Dice coefficient D, which compares the volumes （|.|） of the overlap of both objects to average volume, <span class="math display">\[
\begin{equation*}
D(S,R)= \frac{ 2|S∩R|} { |S| + |R|}
\end{equation*}
\]</span></p>
<h4 id="example-5-multi-otsu-thresholding">Example 5: <a target="_blank" rel="noopener" href="https://scikit-image.org/docs/dev/auto_examples/segmentation/plot_multiotsu.html#sphx-glr-auto-examples-segmentation-plot-multiotsu-py">Multi-Otsu thresholding</a></h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> skimage <span class="token keyword">import</span> data
<span class="token keyword">from</span> skimage<span class="token punctuation">.</span>filters <span class="token keyword">import</span> threshold_multiotsu
<span class="token keyword">from</span> pylab <span class="token keyword">import</span> show<span class="token punctuation">,</span>title<span class="token punctuation">,</span>figure<span class="token punctuation">,</span>subplot<span class="token punctuation">,</span>subplots_adjust<span class="token punctuation">,</span> imshow<span class="token punctuation">,</span> hist<span class="token punctuation">,</span>axvline

<span class="token comment"># The input image.</span>
image <span class="token operator">=</span> data<span class="token punctuation">.</span>camera<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Applying multi-Otsu threshold for the default value, generating</span>
<span class="token comment"># three classes.</span>
thresholds <span class="token operator">=</span> threshold_multiotsu<span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> nbins<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span>

<span class="token comment"># Using the threshold values, we generate the three regions.</span>
regions <span class="token operator">=</span> np<span class="token punctuation">.</span>digitize<span class="token punctuation">(</span>image<span class="token punctuation">,</span> bins<span class="token operator">=</span>thresholds<span class="token punctuation">)</span>

h<span class="token punctuation">,</span>w<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span>                    <span class="token comment"># figure height and width </span>
figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>subplots_adjust<span class="token punctuation">(</span>hspace<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> wspace<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">)</span>

subplot<span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
imshow<span class="token punctuation">(</span>image<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>title<span class="token punctuation">(</span><span class="token string">'original'</span><span class="token punctuation">)</span>

subplot<span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
hist<span class="token punctuation">(</span>image<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">,</span> histtype <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>title<span class="token punctuation">(</span><span class="token string">'Histogram divided by different classes'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> thresh <span class="token keyword">in</span> thresholds<span class="token punctuation">:</span>
    axvline<span class="token punctuation">(</span>thresh<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span>
    
subplot<span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
imshow<span class="token punctuation">(</span>regions<span class="token punctuation">)</span><span class="token punctuation">;</span>title<span class="token punctuation">(</span><span class="token string">'multi-class segmentation using otsu multithresholding'</span><span class="token punctuation">)</span>
show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="exercise-3.1-multi-otsu-thresholding-for-segmenting-ventricles-and-white-matter.">Exercise 3.1 <a target="_blank" rel="noopener" href="https://scikit-image.org/docs/dev/auto_examples/segmentation/plot_multiotsu.html#sphx-glr-auto-examples-segmentation-plot-multiotsu-py">Multi-Otsu thresholding</a> for segmenting ventricles and white matter.</h4>
<p>By following the example 5, solve exercise 3.1:</p>
<ul>
<li><p>Read input image （<a target="_blank" rel="noopener" href="https://canvas.vub.be/courses/18933/files/folder/Practical%20Sessions/WPO3?preview=658541">Brain.tiff</a>） using <a target="_blank" rel="noopener" href="https://pypi.org/project/imread/">imread</a></p></li>
<li><p>Read groundtruth image for ventricals segmentation （<a target="_blank" rel="noopener" href="https://canvas.vub.be/courses/18933/files/folder/Practical%20Sessions/WPO3?preview=679523">GroundTruthVentricles.tiff</a>）</p></li>
<li><p>Read groundtruth image for white matter segmentation （<a target="_blank" rel="noopener" href="https://canvas.vub.be/courses/18933/files/folder/Practical%20Sessions/WPO3?preview=658544">grndTruthWM1.tiff</a>）</p></li>
<li><p>Apply <a target="_blank" rel="noopener" href="https://scikit-image.org/docs/dev/auto_examples/segmentation/plot_multiotsu.html#sphx-glr-auto-examples-segmentation-plot-multiotsu-py">multi-Otsu threshold</a> on the input image with number of classes is 4.</p></li>
<li><p>Plot the histogram and the four thresholds obtained from <a target="_blank" rel="noopener" href="https://scikit-image.org/docs/dev/auto_examples/segmentation/plot_multiotsu.html#sphx-glr-auto-examples-segmentation-plot-multiotsu-py">multi-Otsu</a>, result of multi-class segmentation using <a target="_blank" rel="noopener" href="https://scikit-image.org/docs/dev/auto_examples/segmentation/plot_multiotsu.html#sphx-glr-auto-examples-segmentation-plot-multiotsu-py">multi-Otsu</a> and different four regions. Hint for plotting four different regions:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">b0 <span class="token operator">=</span> regions<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">;</span>
imshow<span class="token punctuation">(</span>b0<span class="token punctuation">,</span><span class="token string">'gray'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
title<span class="token punctuation">(</span><span class="token string">'Background'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

b1 <span class="token operator">=</span>regions<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">;</span>
imshow<span class="token punctuation">(</span>b1<span class="token punctuation">,</span><span class="token string">'gray'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
title<span class="token punctuation">(</span><span class="token string">'Ventricles'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

b2 <span class="token operator">=</span> regions<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">;</span>
imshow<span class="token punctuation">(</span>b2<span class="token punctuation">,</span><span class="token string">'gray'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
title<span class="token punctuation">(</span><span class="token string">'Gray matter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

b3 <span class="token operator">=</span> regions<span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">;</span>
imshow<span class="token punctuation">(</span>b3<span class="token punctuation">,</span><span class="token string">'gray'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
title<span class="token punctuation">(</span><span class="token string">'White matter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
show<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p>Calculate Dice coefficient between segmented ventricals （b1） and groundtruth image for ventricals segmentation</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">GroundTruthVentricles<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>Calculate Dice coefficient between segmented gray matter （b3） and groundtruth image for white matter segmentation</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">grndTruthWM1<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>Dice coefficient function:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">im1 <span class="token operator">=</span> im1<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">bool</span><span class="token punctuation">)</span>
im2 <span class="token operator">=</span> im2<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">bool</span><span class="token punctuation">)</span>
intersect <span class="token operator">=</span> np<span class="token punctuation">.</span>logical_and<span class="token punctuation">(</span>im1<span class="token punctuation">,</span>im2<span class="token punctuation">)</span>
<span class="token keyword">return</span> <span class="token number">2</span><span class="token operator">*</span>intersect<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>im1<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> im2<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="exercise-3.2-region-growing-segmentation">Exercise 3.2 Region Growing Segmentation</h4></li>
</ul>
<p>You should note that in the previous exercise it was not possible to separate the ventricles or white matter from some other structures completely. In this exercise will attempt to do this by implementing a region growing algorithm in its simplest form. The algorithm should output a binary image with pixel values 1 for the structure under study and 0 for all other pixels. As an input it should use one or two threshold values that were obtained from the previous exercise and a seed point.</p>
<p>To select your seeds for the region growing algorithm, inspect the image and find a point coordinate （X,Y） which later will be used as a seed point for your segmentation algorithm. A chosen point location has to be within the structure you are planning to segment.</p>
<p>Using the implemented algorithm, try to segment each of the ventricles and the white matter using suitable seed points and calculate the Dice coefficients with respect to the ground truth images introduced above.</p>
<p>Note: region growing function is given.</p>
<h5 id="ventricles-segmentation">Ventricles segmentation</h5>
<ol type="1">
<li><p>Read input image （<a target="_blank" rel="noopener" href="https://canvas.vub.be/courses/18933/files/folder/Practical%20Sessions/WPO3?preview=658541">Brain.tiff</a>）</p></li>
<li><p>Read groundtruth image for ventricals segmentation （<a target="_blank" rel="noopener" href="https://canvas.vub.be/courses/18933/files/folder/Practical%20Sessions/WPO3?preview=679523">GroundTruthVentricles.tiff</a>）</p></li>
<li><p>Apply <a target="_blank" rel="noopener" href="https://scikit-image.org/docs/dev/auto_examples/segmentation/plot_multiotsu.html#sphx-glr-auto-examples-segmentation-plot-multiotsu-py">multi-Otsu threshold</a> on the input image with number of classes is 4.</p>
<p>For the first ventricle segmentation</p></li>
<li><p>Choose seed point. There are two ventricles, therefore, user has to repeat the process of choosing seed point twice.</p></li>
<li><p>Apply region growing function using selected seed point, calculated threshold, and connectivity = 4.</p>
<blockquote>
<p>Hint:</p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">seg1 <span class="token operator">=</span> region_growing<span class="token punctuation">(</span>Image<span class="token punctuation">,</span> seed<span class="token punctuation">,</span> thresholds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> conn<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>For the second ventricle segmentation</p></li>
<li><p>Repeat steps 4 and 5</p></li>
<li><p>Get final segmentation by adding first and second ventricle segmentations.</p></li>
<li><p>Calculate Dice coefficient between final ventricles segmentation and groundtruth （GroundTruthVentricles[:,:,0]）.</p></li>
</ol>
<h5 id="white-matter-segmentation">White matter segmentation</h5>
<ol type="1">
<li><p>Read input image （<a target="_blank" rel="noopener" href="https://canvas.vub.be/courses/18933/files/folder/Practical%20Sessions/WPO3?preview=658541">Brain.tiff</a>）</p></li>
<li><p>Read groundtruth image for white matter segmentation （grndTruthWM1.tiff）</p></li>
<li><p><a target="_blank" rel="noopener" href="https://canvas.vub.be/courses/18933/files/folder/Practical%20Sessions/WPO3?preview=658544">Apply</a> <a target="_blank" rel="noopener" href="https://scikit-image.org/docs/dev/auto_examples/segmentation/plot_multiotsu.html#sphx-glr-auto-examples-segmentation-plot-multiotsu-py">multi-Otsu threshold</a> on the input image with number of classes is 4.</p></li>
<li><p>Choose seed point.</p></li>
<li><p>Apply region growing function using selected seed point, calculated threshold, and connectivity = 4.</p>
<blockquote>
<p>Hint:</p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">seg <span class="token operator">=</span> region_growing<span class="token punctuation">(</span>Image<span class="token punctuation">,</span> seed<span class="token punctuation">,</span> thresholds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> conn<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>Calculate Dice coefficient between final ventricles segmentation and groundtruth （grndTruthWM1[:,:,0]）.</p></li>
</ol>
<p><strong>Report</strong></p>
<ul>
<li>For Exercises 3.1 and 3.2 plot a 2-by-2 figure of the segmentations of the ventricles and white matter and their corresponding ground truth.</li>
<li>Provide a table of the obtained Dice coefficients for each method and each structure.</li>
<li>Briefly comment on the obtained results for the segmentations and corresponding measures.</li>
</ul>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Chaoqun Yin</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://yintelligence.tech/2021/06/13/2021-06-13-Biomedical-Image-Processing/">https://yintelligence.tech/2021/06/13/2021-06-13-Biomedical-Image-Processing/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint polocy. If reproduced, please indicate source
                    <a href="/about" target="_blank">Chaoqun Yin</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Biomedical-Signals-and-Images/">
                                    <span class="chip bg-color">Biomedical Signals and Images</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2021/06/14/2021-06-14-Biomedical-Image-Processing/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/1.jpg" class="responsive-img" alt="Biomedical Image Processing">
                        
                        <span class="card-title">Biomedical Image Processing</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-06-14
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Digital-Health/" class="post-category">
                                    Digital Health
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Biomedical-Signals-and-Images/">
                        <span class="chip bg-color">Biomedical Signals and Images</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/06/12/2021-06-12-Concurrent-Processes/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/12.jpg" class="responsive-img" alt="Concurrent Processes">
                        
                        <span class="card-title">Concurrent Processes</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            本章将介绍与多道程序设计相关的一些方面。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-06-12
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Computer-Systems/" class="post-category">
                                    Computer Systems
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Computer-Systems/">
                        <span class="chip bg-color">Computer Systems</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + 'From: Chaoqun Yin<br />'
            + 'Author: Chaoqun Yin<br />'
            + 'Link: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>



    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">Chaoqun Yin</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2021";
                    var startMonth = "1";
                    var startDate = "28";
                    var startHour = "2";
                    var startMinute = "1";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/yintelligence" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:Yintelligence@outlook.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
